# (APPENDIX) Appendiks {-} 

\part{Appendiks}

# Underliggende teoretiske resultater

## Udledning af den optimale myopiske portefølje {#udlmyo}
I denne Sektion udledes den optimale portefølje på tidspunkt $t$ givet ved: Ligning \@ref(eq:Løsning) og Ligning \@ref(eq:Multalpha) for hhv. tilfældet med et risikobærende aktiv, $n=1$, samt tilfældet med flere risikobærende aktiver, $n>1$. Ved indsættelse af den betingede middelværdi, Ligning \@ref(eq:Forvport), samt den betingede varians, Ligning \@ref(eq:Varport). Kan Maksimeringsproblemet \@ref(eq:Statmaks) omskrives til
$$\max_{\alpha_t} \mathcal{L}=\alpha_t\left(R_{t+1} - R_{0,t+1}\right)-\frac{k}{2}\alpha_t^2\sigma_t^2.$$

I ovenstående er det ekstra led $R_{0,t+1}$ undladt idet, at det ikke ændrer maksimeringsproblemet.

Ved differentiation af ovenstående funktion, $\mathcal{L}(\cdot)$, mht. $\alpha_t$ opnåes førsteordensbetingelsen
\begin{align*}
\frac{\partial \mathcal{L}}{\partial \alpha_t} &= \mathbb{E}_t(R_{t+1}) - R_{0,t+1} - \frac{k}{2}2\alpha\sigma_t^2=0\\
&\Updownarrow\\
\alpha&=\frac{\mathbb{E}_t\left(R_{t+1}\right)-R_{0,t+1}}{k\sigma_t^2}.
\end{align*}

Dermed er den optimale portefølje udledt, for tilfældet med ét risikobærende aktiv. For udledningen af den optimale portefølje på tidspunkt $t$ i tilfældet med flere risikobærende aktiver, differentieres funktionen, fra Maksimeringsproblemet \@ref(eq:MultStatmaks) mht. $\bm{\alpha}_t$, dermed fås
\begin{align*}
\frac{\partial \mathcal{L}}{\partial \bm{\alpha}_t} &= (\mathbb{E}_t(\bm{R}_{t+1})- R_{0,t+1}\bm{\ell}) - \frac{k}{2}2\bm{\Sigma_t}\bm{\alpha}_t = 0\\
&\Updownarrow\\
\bm{\alpha}_t&=\frac{1}{k}\bm{\Sigma}_t^{-1}(\mathbb{E}_t(\bm{R}_{t+1})-R_{0,t+1}\bm{\ell}).
\end{align*}

Her er de gængse regler for matrix differentiation og manipulation benyttet. 

## Udledning af *ARA* samt *RRA*
I denne Sektion udledes *Absolute Risk Aversion* samt *Relative Risk Aversion* målene for de tre præsenterede nyttefunktioner: kvadratisk nytte, eksponentiel nytte (*CARA*) og potens nytte (*CRRA*). Fælles for alle nyttefunktionerne er, at de er fuldstændigt defineret over formue.

### Kvadratisk nytte
For parametrene $a,b\in\mathbb{R}$ er kvadratisk nytte defineret som
\begin{equation*}
U(W_{t+1})=aW_{t+1}-bW_{t+1}^2.
\end{equation*}

*Absolute Risk Aversion* er defineret ved
$$\text{ARA}(W)=-\frac{U''(W)}{U'(W)}.$$

Altså vil kvadratisk nytte have følgende *ARA*
$$\text{ARA}_k(W_{t+1})=\frac{2b}{a-2bW_{t+1}},$$

hvor $k$ er notationen for kvadratisk. Fra ovenstående kan det ses, at *ARA* for kvadratisk nytte er stigende i $W_{t+1}$. Hvilket ikke er retsmæssigt, ift. den generelle holdning blandt emprisk litteratur. 

*Relative Risk Aversion* er defineret ved
$$\text{RRA}(W)=-\frac{WU''(W)}{U'(W)}.$$

Altså vil kvadratisk nytte have følgende *RRA*
$$\text{RRA}_k(W_{t+1})= \frac{2bW_{t+1}}{a-2bW_{t+1}}.$$

Endnu engang bemærkes det, at også *RRA* for kvadratisk nytte er stigende i $W_{t+1}$. 

### Eksponentiel nytte
Eksponentiel nytte betegnes undertiden *Constant Absolute Risk Aversion*. Eksponentiel nytte antager at variablene i modellen er normalfordelt. Lad $\theta\in\mathbb{R}$ være parametren i modellen, da vil eksponentiel nytte være defineret ved
\begin{equation*}
U(W_{t+1})=-\exp\left(-\theta W_{t+1}\right).
\end{equation*}

Eksponential nytte har følgende *ARA*
$$\text{ARA}_e(W_{t+1})=\frac{\theta^2\exp\left(-\theta W_{t+1}\right)}{\theta\exp\left(-\theta W_{t+1}\right)}=\theta,$$

hvor $e$ er notationen for eksponentiel. Fra ovenstående kan det ses, at *ARA* for eksponentiel nytte er konstant, som *CARA*-betegnelsen dækker over. Eksponentiel nytte har følgende *RRA*
$$\text{RRA}_e(W_{t+1})= \theta W_{t+1}.$$

Fra ovenstående ses det, at *RRA* for eksponentiel nytte er proportional til $W_{t+1}$.

### Potens nytte
Potens nytte kræver, at afkast af aktiverne og formue er lognormal fordelt. Potens nytte er bedre kendt under betegnelsen *Constant Relative Risk Aversion*. Lad parameteren $\gamma\in\mathbb{R}$ være givet, da er nyttefunktionen defineret for $W_{t+1}\geq 0$, som
$$U(W_{t+1})=\begin{cases} \frac{W_{t+1}^{1-\gamma}-1}{1-\gamma},\quad \gamma\neq 1\\
\log(W_{t+1}),\quad \gamma = 1. \end{cases}$$

Potens nytte har følgende *ARA*
$$\text{ARA}_p(W_{t+1})= \frac{\gamma W_{t+1}^{-\gamma-1}}{W_{t+1}^{-\gamma}}=\frac{\gamma}{W_{t+1}},$$

hvor $e$ er betegnelsen for eksponentiel. Det ses at *ARA* er faldende i $W_{t+1}$. Potens nytte har følgende *RRA*
$$\text{RRA}_p(W_{t+1})= \gamma,$$

som altså er konstant, dette ligger også til grund for *CRRA*-betegnelsen.

## Udledning af specialtilfældet for potens nytte
I denne Sektion udledes specialtilfældet af Ligning \@ref(eq:Potnytte), dvs. nyttefunktions form for risikoaversion, $\gamma$, lig $1$. Ved brug af *l'Hôpital's regel*. Reglen er defineret for to funktioner, $f(\cdot)$ og $g(\cdot)$, som er differentiable på et åbent interval $I$, undtagen for et fast punkt $c\in I$. Hvis
$$\lim_{x\to c} f(x)=\lim_{x\to c}g(x)=0\,\text{eller} \pm \infty,$$

samt
$$g'(x)\neq 0,\quad \forall X\in I,\,x\neq c$$

og grænsen
$$\lim_{x\to c} \frac{f'(x)}{g'(x)},$$

eksisterer, da gælder følgende lighed
$$\lim_{x\to c}\frac{f(x)}{g(x)}=\lim_{x\to c}\frac{f'(x)}{g'(x)}.$$

Altså kan der opnåes et udtryk for grænsen, som kan evalueres. For $\gamma\rightarrow 1$ fås da
$$\lim_{\gamma\to 1}\frac{W_{t+1}^{1-\gamma}-1}{1-\gamma}=\lim_{\gamma\to 1}\frac{-W_{t+1}^{1-\gamma}\log\left(W_{t+1}\right)}{-1}=\log\left(W_{t+1}\right).$$

Dermed er tilfældet udledt.

# Den optimale dynamiske strategi
Dette appendiks vil udlede den optimale porteføljestrategi, som beskrevet i Sektion ??. Udledningen vil følge [@JurVic2011] Appendiks C, som beskriver metoden, med enkelte dele som varierer.

Uden tab af generalitet, kan det $k$-periode dynamiske porteføljeproblem løses, ved benyttelse af en rekursiv forlængelse af løsningen for optimalitetsproblemet hørende til de sidste to perioder. Først udledes porteføljestrategien i den sidste periode -- denne vil fungere som basis for den såkaldte *policy*-funktion i rekursionen -- samt den tilhørende *value* funktion. Herefter vil problemet i den foregående periode løses, dette problem er en funktion af koefficienterne fra *policy*- og *value*-funktionerne fra den sidste periode. Dette skaber det rekursive forhold mellem de to sidste tilstødende perioder, som herefter generalises til to generelle tilstødende perioder.

Investorens problem, i et to-periodes perspektiv, er at maksimere sin forventede nytte
\begin{align*}
\mathbb{E}_{t+k-2}[\frac{1}{1-\gamma} W_{t+k}^{1-\gamma}]&=\frac{1}{1-\gamma} W_{t+k-2}^{1-\gamma} \mathbb{E}_{t+k-2}[(1+R_{p,t+k-1})^{1-\gamma}(1+R_{p,t+k})^{1-\gamma}]\\
&=\frac{1}{1-\gamma} W_{t+k-2}^{1-\gamma} \mathbb{E}_{t+k-2}[\exp((1-\gamma) r_{p,t+k-1}) \mathbb{E}_{t+k-1}[\exp((1-\gamma)r_{p,t+k})]],
\end{align*}

ved at vælge følgen af vægte $\left\{\bm{\alpha}_{t+k-2}^2, \bm{\alpha}_{t+k-1}^1\right\}$. Variablene er indekseret med sænket skrift, som repræsenterer tidspunktet de bliver anvendt, og hævet skrift tid, der repræsenterer tid tilbage indtil investeringshorisonten.

## Tidspunkt $t+k-1$ ($\tau=1$)

### *Policy*-funktionen
Maksimeringsproblemet på tidspunkt $t+k-1$ er uændret ift. problemet som blev beskrevet ovenfor.
$$\max_{\bm{\alpha}_{t+k-1}^1} \mathbb{E}_{t+k-1}[\exp((1-\gamma)r_{p,t+k})] = \exp\left((1-\gamma) \mathbb{E}_{t+k-1}[r_{p,t+k}]+\frac{1}{2}(1-\gamma)^2 \mathbb{V}_{t+k-1}[r_{p,t+k}]\right).$$

Ved brug af selektionsmatricerne $\bm{H}_x$ og $\bm{H}_1$, er de første to momenter af porteføljeafkastet givet ved
\begin{align*}
\mathbb{E}_{t+k-1}[r_{p,t+k}]&= \bm{\alpha}_{t+k-1}^{1\prime} \bm{H}_x (\bm{\Phi}_0 +\bm{\Phi}_1\bm{z}_{t+k-1}) + \bm{H}_1(\bm{\Phi}_0 +\bm{\Phi}_1\bm{z}_{t+k-1})+\frac{1}{2} \bm{\alpha}_{t+k-1}^{1\prime} (\bm{\sigma}_x^2-\bm{\Sigma}_{xx}\bm{\alpha}_{t+k-1}^{1})\\
\mathbb{V}_{t+k-1}[r_{p,t+k}]&=\bm{\alpha}_{t+k-1}^{1\prime}\bm{\Sigma}_{xx}\bm{\alpha}_{t+k-1}^{1}+ \sigma_0^2 + 2\bm{\alpha}_{t+k-1}^{1\prime}\bm{\sigma}_{0x}
\end{align*}

Den følgende førsteordensbetingelse, fremkommer efter substituion af ovenstående momenter ind i Maksimeringsproblemet ?? og dernæst differentiation 
$$\bm{H}_x(\bm{\Phi}_0 +\bm{\Phi}_1\bm{z}_{t+k-1})+\frac{1}{2}\bm{\sigma}_x^2 - \bm{\Sigma}_{xx} \bm{\alpha}_{t+k-1}^{1}+(1-\gamma) (\bm{\Sigma}_{xx}\bm{\alpha}_{t+k-1}^{1}+\bm{\sigma}_{0x})=0.$$

Antages nu, at kovariansmatricen $\bm{\Sigma}_{xx}$ er ikke-singulær er ovenstående løst af
$$\bm{\alpha}_{t+k-1}^{1}=\frac{1}{\gamma}\bm{\Sigma}_{xx}^{-1}\left(\bm{H}_x(\bm{\Phi}_0 +\bm{\Phi}_1\bm{z}_{t+k-1})+\frac{1}{2}\bm{\sigma}_x^2+(1-\gamma) \bm{\sigma}_{0x}\right).$$

En nyttig omskrivning af den optimale portefølje, er at skrive den som en affin funktion af $\bm{z}_{t+k-1}$
\begin{equation}
\bm{\alpha}_{t+k-1}^{1} = A_0^1 + A_1^1\bm{z}_{t+k-1}, (\#eq:pol1p)
\end{equation}

hvor
\begin{align*}
A_0^1&=\frac{1}{\gamma} \bm{\Sigma}_{xx}^{-1}\left(\bm{\Phi}_0^x + \frac{1}{2}\bm{\sigma}_x^2+(1-\gamma)  \bm{\sigma}_{0x}\right)\\
A_1^1&=\frac{1}{\gamma} \bm{\Sigma}_{xx}^{-1}\bm{\Phi}_1^x.
\end{align*}

Dette afslutter udledningen for *policy*-funktionen på tidspunkt $t+k-1$.

### *Value*-funktionen
Udledningen for *value*-funktionen på tidspunkt $t+k-1$ startes med substitution af Ligning \@ref(eq:pol1p) ind i portefølje afkast momenterne. Dette gør, at de kan omskrives til funktioner af $A_i^1$ koefficienterne.
\begin{align*}
\mathbb{E}_{t+k-1}[r_{p,t+k}] &= (A_0^1 + A_1^1\bm{z}_{t+k-1})' (\bm{\Phi}_0^x +\bm{\Phi}_1^x\bm{z}_{t+k-1}) + (\bm{\Phi}_0^0 +\bm{\Phi}_1^0 \bm{z}_{t+k-1})\\
&\quad+\frac{1}{2} (A_0^1 + A_1^1\bm{z}_{t+k-1})' (\bm{\sigma}_x^2-\bm{\Sigma}_{xx}(A_0^1 + A_1^1\bm{z}_{t+k-1}))\\
&=\bm{\Phi}_0^0+ A_0^{1\prime} (\bm{\Phi}_0^x + \frac{1}{2} (\bm{\sigma}_x^2 - \bm{\Sigma}_{xx} A_0^1)) + \bm{z}_{t+k-1}' A_1^{1\prime} (\bm{\Phi}_0^x + \frac{1}{2} (\bm{\sigma}_x^2  - \bm{\Sigma}_{xx} A_0^1))\\
&\quad+ (\bm{\Phi}_1^0 + A_0^{1\prime} (\bm{\Phi}_1^x - \frac{1}{2} \bm{\Sigma}_{xx} A_1^1)) \bm{z}_{t+k-1} +\bm{z}_{+k-1t}' A_1^{1\prime} (\bm{\Phi}_1^x - \frac{1}{2} \bm{\Sigma}_{xx} A_1^1) \bm{z}_{t+k-1}\\
\mathbb{V}_{t+k-1}[r_{p,t+k}]&=(A_0^1 + A_1^1\bm{z}_{t+k-1})'\bm{\Sigma}_{xx}(A_0^1 + A_1^1\bm{z}_{t+k-1})+ \bm{\sigma}_0^2 + 2(A_0^1 + A_1^1\bm{z}_{t+k-1})'\bm{\sigma}_{0x}\\
&=\sigma_0^2 + A_0^{1\prime} (\bm{\Sigma}_{xx} A_0^1 + 2\bm{\sigma}_{0x}) + A_0^{1\prime}\bm{\Sigma}_{xx}A_1^1 \bm{z}_{t+k-1}\\
&\quad+\bm{z}_{t+k-1}' A_1^{1\prime} (\bm{\Sigma}_{xx} A_0^1 + 2\bm{\sigma}_{0x}) + \bm{z}_{t+k-1}' A_1^{1\prime} \bm{\Sigma}_{xx} A_1^1 \bm{z}_{t+k-1}.
\end{align*}

Siden hvert led i ovenstående summer er en skalar, kan ethvert komponent, i hvert led, frit udskiftes med dets transponerede. Dette medfører at leddene kan skrives ift. $\bm{z}_{t+k-1}$ og $\bm{z}_{t+k-1}'$. Indsættes ovenstående momenter nu i $t+k-1$ optimeringsfunktionen, opnåes en forventning af en eksponentiel polynomisk funktion af tilstandsvektoren, som kan beregnes i lukket form, for at opnå den maksimerede *value*-funktion
$$\mathbb{E}_{t+k-1}[\exp((1-\gamma)r_{p,t+k}^*)] = \exp\left((1-\gamma) (B_0^1 + B_1^1 \bm{z}_{t+k-1}+\bm{z}_{t+k-1}'B_2^1 \bm{z}_{t+k-1})\right),$$

hvor
\begin{align*}
B_0^1&=\bm{\Phi}_0^0 + A_0^{1\prime} (\bm{\Phi}_0^x + \frac{1}{2} \bm{\sigma}_x^2) + \frac{1-\gamma}{2}(\sigma_0^2 + 2 A_0^{1\prime} \bm{\sigma}_{0x}) - \frac{\gamma}{2} A_0^{1\prime} \bm{\Sigma}_{xx} A_0^1\\
B_1^1&=\bm{\Phi}_1^0 + A_0^{1\prime}(\bm{\Phi}_1^x - \gamma \bm{\Sigma}_{xx} A_1^1) + (\bm{\Phi}_{0}^x + \frac{1}{2} \bm{\sigma}_x^2 + (1-\gamma)\bm{\sigma}_{0x})' A_1^1\\
B_2^1&=A_1^{1\prime} (\bm{\Phi}_1^x - \frac{\gamma}{2} \bm{\Sigma}_{xx} A_1^1).
\end{align*}

## Tidspunkt $t+k-2$ ($\tau=2$)

### *Policy*-funktionen
Det næstsidste periode problem, $t+k-2$, involverer at vælge porteføljevægtene $\bm{\alpha}_{t+k-2}^2$, som maksimerer den følgene funktion
$$\frac{W_{t+k-2}^{1-\gamma}}{1-\gamma} \mathbb{E}_{t+k-2}[\exp((1-\gamma) r_{p,t+k-1}) \exp((1-\gamma) (B_0^1 + B_1^1 \bm{z}_{t+k-1} + \bm{z}_{t+k-1}' B_2^1\bm{z}_{t+k-1}))]$$

Eftersom hverken $\tfrac{1}{1-\gamma}$ eller $W_{t+k-2}^{1-\gamma}$ påvirker optimum kan det fjernes fra optimeringsfunktionen. Ved brug af Taylor approksimationen, [@CampVicCha2003], kan $(t+k-1)$ log porteføljeafkastet beskrives som en funktion af $\bm{z}_{t+k-1}$. Dette tillader, at leddene kan samles i eksponentialet og derefter beregne forventningen. 

$(t+k-1)$ log porteføljeafkastet approksimeres ved
\begin{align*}
r_{p,t+k-1}&=\bm{\alpha}_{t+k-2}^{2\prime} + \bm{x}_{t+k-1} + r_{0,t+k-1} + \frac{1}{2} \bm{\alpha}_{t+k-2}^{2\prime} (\bm{\sigma}_x^2 - \bm{\Sigma}_{xx} \bm{\alpha}_{t+k-2}^{2})\\
           &=\begin{pmatrix} 1 & \bm{\alpha}_{t+k-2}^{2} & \bm{0}\end{pmatrix} \bm{z}_{t+k-1} + \frac{1}{2}\bm{\alpha}_{t+k-2}^{2\prime} (\bm{\sigma}_x^2 - \bm{\Sigma}_{xx} \bm{\alpha}_{t+k-2}^{2}).
\end{align*}

Ved substition af ovenstående ind i $(t+k-2)$ optimeringsfunktionen fås
$$\mathbb{E}_{t+k-2}[\exp((1-\gamma)  (\frac{1}{2}\bm{\alpha}_{t+k-2}^{2\prime} (\bm{\sigma}_x^2 - \bm{\Sigma}_{xx} \bm{\alpha}_{t+k-2}^{2}) + B_0^1 + (B_1^1 + \begin{pmatrix} 1 & \bm{\alpha}_{t+k-2}^{2} & \bm{0}\end{pmatrix} ) \bm{z}_{t+k-1} + \bm{z}_{t+k-1}'B_2^1 \bm{z}_{t+k-1} ))].$$

Fra ovenstående ses, at investoren på tidspunkt $(t+k-2)$ ved, at kun de sidste to summer i eksponentialet er stokastiske. Derfor fokusers, for nu, på at evaluere den følgende funktion, givet investorens valg af $\bm{\alpha}_{t+k-2}^{2}$
$$\mathbb{E}_{t+k-2}[ \exp( (1-\gamma) ((B_1^1 + \begin{pmatrix} 1 & \bm{\alpha}_{t+k-2}^{2} & \bm{0}\end{pmatrix} ) \bm{z}_{t+k-1} + \bm{z}_{t+k-1}'B_2^1 \bm{z}_{t+k-1}  )) ].$$

Resultatet af denne beregning vil herefter substitueres ind i den oprindelige optimeringsfunktion, for at opnå forvetningen af *value*-funktionen betinget på investorens porteføljevalg, som herefter er maksimeret over $\bm{\alpha}_{t+k-2}^{2}$.

### *Value*-funktionen

# Shiller