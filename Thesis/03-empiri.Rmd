```{r setup, include=FALSE}
Sys.setlocale("LC_TIME", "Danish")
library(tidyverse)
library(quantmod)
library(kableExtra)
library(ggfortify)
library(latex2exp)

if (knitr::is_html_output()) {
  options(knitr.table.format = "html")
} else {
  options(knitr.table.format = "latex") 
}
```

```{r setup-plots, include=FALSE}
if (knitr::is_html_output()) {
  knitr::opts_chunk$set(out.width = '100%') 
} else {
  knitr::opts_chunk$set(out.width = '100%')
}
```

\part{Den empiriske analyse}

```{r script1, code = readLines("C:/Users/AKF/Documents/Matematik-Okonomi/5. Ar/2. Semester/Master-Thesis/Scripts/Script.R"), include=FALSE, cache=TRUE}
```

# Implementering
Kapitel \@ref(varkapitel) markerede slutningen af den underliggende teoretiske gennemgang samt diskussion. Nu tages fat på de nødvendige statistiske værktøjer, som er et nødvendige, for at kunne implementere den præsenterede porteføljemodel. Derfor vil dette kapitel lægge fundamentet for den empiriske del, som på den måde kan færdiggøre den optimale porteføljestrategi baseret på historiske data, der bliver gennemgået og gransket i Kapitel \@ref(kapiteldatab). Sektion \@ref(sekprædik) vil præsentere de oftest anvendte lineære modeller til at teste afkastprædiktabilitet. Sektion \@ref(#sektestaftids) vil fungere som beskrivelse af de tests, som kan teste de anvendte tidsserier for de underliggende antagelser, der specielt er krævet af VAR-processen. Derudover vil Sektion \@ref(sekmodelselek) sætte spørgsmåltegn ved højtparameteriserede modeller. Sektionen vil derfor diskutere problemet og præsentere et modelselektionsgrundlag, etableret for at kunne skabe en restringeret kvantiativ stærk model, som der -- ikke mindst -- samtidig er valgt ud fra en kvalitativ skepsis af undertegnede.

## Prædiktabilitstest {#sekprædik}

### Univariat

### Multipel

### Potentiel bias

## Test af tidsserier {#sektestaftids}

### Test af normalitet

### Augmented Dickey-Fuller test

### Phillips-Perron test

### Kwiatkowski-Phillips-Schmidt-Shin test

## Modelselektion {#sekmodelselek}

# Data beskrivelse {#kapteildatab}
Dette kapitel har til formål at give en uddybende beskrivelse af det anvendte data -- mht. både aktivklasser og forklarende variable -- til den empiriske analyse. Alle variable består af kvartalsvise observationer over tidsperioden 1954 2. kvartal til 2018 4. kvartal grundet dataophør. Startkvartalet er valgt på baggrund af, at den amerikanske centralbank, *Federal Reserve System*, kort tid forinden, havde givet den amerikanske korte rente, lov til at variere frit i markedet. Variablene er vist i niveauer. Kapitlet er organiseret som følger. Sektion \@ref(aktivklasser) beskriver detaljeret hver aktivklasse og dets tilhørende beskrivende statistik. Sektion \@ref(pvariable) indeholder en tilsvarende beskrivelse af de tilhørende tilstandsvariable. Korrelationen mellem aktivklasserne og tilstandsvariablene undersøges i Sektion \@ref(korr). Sektion \@ref(ops) giver en opsummering af kapitlets statistiske fund. Tidsserien for hver aktivklasse og prædiktionsvariabel visualiseres med tilhørende recessionsperioder som defineret af [@NBER2020].

## Beskrivelse af aktivklasser{#aktivklasser}
Mængden af aktivklasser, som pt. er tilgængelige på finansmarkedet har aldrig været større. Udover aktier og obligationer, findes et væld af eksponeringsområder og/eller finansielle produkter heriblandt ejendom, derivater, futures, forwards, kryptovaluta, valuta mm. For at holde denne analyse på et simpelt niveau medtages de mest anvendte aktivklasser for institutionelle og private investorer. Hvilket også er de mest anvendte i eksisterende litteratur, [@CampVic2003; @CampVic1999], [@JurVic2011], [@Engsted2012], [@CampVicCha2003]. I det følgende vil egenskaberne for aktivklasserne: det risikofrie afkast, merafkastet på aktier, merafkastet på statsobligationer og merafkastet på virksomhedsobligationer beskrives og derudover vil den tilhørende beskrivende statistik for hvert aktiv belyses.

### Det risikofrie afkast -- $r_{t+1}^{\textnormal{rf}}$
Essencen af et risikofrit aktiv er at repræsentere et afkast med varians lig $0$. Dette betegnes undertiden også som et sikkert afkast. Udover at give investoren muligheder for indlån, kan investoren også udvide sine investeringsmuligheder ved at låne til den risikofrie rente, dvs. have en kort position i det risikofrie aktiv. Et ofte valgt aktiv i litteraturen, som en proxy for det risikofrie aktiv, er de kortefristede statsværdipapirer, [@CampVic2003; @CampVic1999], [@JurVic2011], [@Engsted2012], [@CampVicCha2003]. Disse betegnes i U.S.A. som *T-Bills*. Valget af netop dette aktiv sker på baggrund af den historiske og nuværende meget lave risiko for statskonkurser, [@Beers2017]. Eksempelvis gik den danske stat tilnærmelsesvis senest bankerot under *Statsbankerotten* i 1813 efter *Napoleonskrigene*. Derfor benyttes det amerikanske statspapir med kort løbetid, mere præcist anvendes den 90-dages amerikanske *T-Bill*, som en proxy for det risikofrie aktiv. Data over afkast er fra [@CRSPt90] hentet gennem [@WRDSt90]. Log netto afkastet af det risikofrie aktiv beregnes som log forskellen mellem det kvartalsvise brutto afkast på den amerikanske 90-dages *T-Bill* og den kvartalsvise inflationsrate, målt via *Consumer Price Index*. Nettoafkastet har et kvartalsvist justeret afkast på `r round(DESCRIPTIVE$adj_mean[1]*100, 1)`$\%$ med en kvartalsvis volatilitet på `r round(DESCRIPTIVE$sd[1]*100, 1)`$\%$. Som det kan ses på kvantilerne har det risikofrie afkast givet negativt afkast sommetider. Et histogram indikerer en højreskæv fordeling af afkast, hvilket også underbygges af en skævhed på `r round(DESCRIPTIVE$skew[1], 3)`. Med en kurtosis på `r round(DESCRIPTIVE$kurt[1], 3)` haves en leptokurtisk fordeling, med tykkere/længere haler og et smallere samt højere cetrum. Disse tal er konsistente med [@CampVic2003]. Figur \@ref(fig:NET-TB-tids) viser et plot over tidsserien, Figur \@ref(fig:NET-TB-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:NET-TB-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r NET-TB-tids, echo=FALSE, fig.align='center', fig.cap="Tidsserie af log netto renten \\\\\\raggedright Tidsserien spænder fra 2. kvartal 1954 til 4. kvartal 2018.", fig.scap="short", fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$NET_TB))+
  geom_line(aes(x=index(data), y=NET_TB)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$NET_TB), max(data$NET_TB))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$r_{t}^{rf}$"))
```

I forlængelse af beskrivelsen af det risikofrie aktiv, viser Figur \@ref(fig:INF-tids) et plot over tidsserien hørende til inflationsraten.

```{r INF-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af inflationsraten, målt via Consumer Price Index.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(INF) +
  expand_limits(x = min(index(INF)), y = min(INF))+
  geom_line(aes(x=index(INF), y=INF)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(INF), max(INF))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(INF)), max(index(INF))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{inf}$")) +
  xlab("År")
```

```{r NET-TB-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af log netto renten.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(NET_TB), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r NET-TB-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for log netto renten.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = NET_TB)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.005, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(DATA_J$NET_TB_J), sd = sqrt(var(data$NET_TB)))) + 
  geom_vline(data=DATA_J, aes(xintercept=mean(NET_TB_J)), linetype="dashed", color ="red") +
  expand_limits(x = 0, y = 0)+
  coord_cartesian(ylim = c(0, ceiling(max(density(data$NET_TB)$y)))) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Merafkastet på aktier -- $rx_{t+1}^{\textnormal{a}}${#dataak}
For aktivklassen, som skal repræsentere børshandlede aktier, benyttes et markedsværdi-vægtet afkast over et repræsentativt indeks for samtlige handlede aktier på *New York Stock Exchange*, *National Association of Securities Dealers Automated Quotations* og *American Stock Exchange*. Det vægtede afkast er inklusiv udbytte, aktiesplits og nyemissioner for de foregående 12 måneder ledende op til kvartalet. Ved at benytte et sådant forholdsvist bredt indeks, vil delanalysen for aktier være repræsentativt for det globale aktiemarked. Derudover er det ikke kun børsnoterede amerikanskbaserede selskaber, som handles via *NYSE*, *NASDAQ* og *AMEX*, men i stadig større grad også virksomheder uden for U.S.A. Data over afkast er fra [@CRSPakt] og hentet gennem [@WRDSakt]. Log  merafkastet af aktier beregnes som det kvartalsvise log brutto aktieafkast fratrukket det kvartalsvise brutto afkast på den amerikanske 90-dages *T-Bill*. Det ses at aktier har det klart højeste kvartalvise justerede merafkast på `r round(DESCRIPTIVE$adj_mean[2]*100, 1)`$\%$ ift. de andre aktivklasser. Dette høje merafkast følges af en ligeledes høj relativ volatilitet på `r round(DESCRIPTIVE$sd[2]*100, 1)`$\%$. Historisk set har det største negative markedsudsving givet et merafkast/tab på $-30.4\%$, mens det største positive markedsudsving har været på $20\%$. Et histogram sammenholdt med en skævhed på `r round(DESCRIPTIVE$skew[2], 3)` afslører moderat til høj venstreskævhed. Altså har der oftere været negative merafkast ift. positive. Kurtosis på `r round(DESCRIPTIVE$kurt[2], 3)` medører en moderat leptokurtisk fordeling med en anelse tykkere haler, og at ekstreme observationer sker oftere end normalt. Disse tal er konsistente med [@CampVic2003]. Figur \@ref(fig:AKT-tids) viser et plot over tidsserien, Figur \@ref(fig:AKT-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:AKT-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r AKT-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af log merafkastet af aktier.', fig.width=18, fig.height=5, fig.pos='H'}
par(mfrow=c(1,1))
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$AKT))+
  geom_line(aes(x=index(data), y=AKT)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$AKT), max(data$AKT))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$rx_{t}^{a}$"))
```

```{r AKT-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af log merafkastet af aktier.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(AKT), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r AKT-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for log merafkastet af aktier.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = AKT)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.05, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(DATA_J$AKT_J), sd = sqrt(var(data$AKT)))) + 
  geom_vline(data=DATA_J, aes(xintercept=mean(AKT_J)), linetype="dashed", color ="red") +
  expand_limits(x = 0, y = 0)+
  coord_cartesian(ylim = c(0, 7.5)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Merafkastet på statsobligationer -- $rx_{t+1}^{\textnormal{s}}$
Statsobligationer er gældsinstrumenter udstedt af staten i det respektive udstedelsesland, de har til formål at finansiere offentlige udgifter og anses også for at være en substitution for skatter. Siden udstedelsen sker af staten, antages det ofte, at statsobligationer er relativt mindre risikobærende and aktier. Undertiden betegnes statsobligationer fra visse ilande som et *safe haven* for investorer. Eksempelvis har den danske stat pt. en kreditvurdering på AAA, Aaa, AAA af hhv. *Standard \& Poor's*, *Moody's* og *Fitch*, [@TradingEconomics2020]. Til formålet at repræsentere afkastet på statsobligationer anvendes derfor den 10-årige amerikanske statsobligation med konstant løbetid. Data over afkast er fra [@CRSPt90] og hentet gennem [@WRDSt90]. Log  merafkastet af statsobligationener beregnes som det kvartalsvise log brutto afkast fratrukket det kvartalsvise brutto afkast på den amerikanske 90-dages *T-Bill*.  merafkastet har et justeret kvartalsvist afkast på `r round(DESCRIPTIVE$adj_mean[3]*100, 1)`$\%$ med en kvartalsvis volatilitet på `r round(DESCRIPTIVE$sd[3]*100, 1)`$\%$. Statsobligationen har den laveste *Sharpe Ratio* af de tre aktivklasser, hvilket også er forventeligt. Med en skævhed på `r round(DESCRIPTIVE$skew[3], 3)` og kurtosis på `r round(DESCRIPTIVE$kurt[3], 3)` haves en forholdsvis symmetrisk fordeling, men med en anelse tykkere haler. Disse tal er konsistente med [@CampVic2003]. Figur \@ref(fig:S-OBL-tids) viser et plot over tidsserien, Figur \@ref(fig:S-OBL-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:S-OBL-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r S-OBL-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af log merafkastet på statsobligationer.', fig.width=18, fig.height=5, fig.pos='H'}
par(mfrow=c(1,1))
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$S_OBL))+
  geom_line(aes(x=index(data), y=S_OBL)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$S_OBL), max(data$S_OBL))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$rx_{t}^{s}$"))
```

```{r S-OBL-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af log merafkastet af statsobligationer.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(S_OBL), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r S-OBL-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for log merafkastet på statsobligationer.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = S_OBL)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.025, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(DATA_J$S_OBL_J), sd = sqrt(var(data$S_OBL)))) + 
  geom_vline(data=DATA_J, aes(xintercept=mean(S_OBL_J)), linetype="dashed", color ="red") + 
  expand_limits(x = 0, y = 0)+
  coord_cartesian(ylim = c(0, ceiling(max(density(data$S_OBL)$y)))) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Merafkastet på virksomhedsobligationer -- $rx_{t+1}^{\textnormal{v}}$
På samme vis som stater kan finansiere deres aktiviteter via statsobligationer, kan virksomheder udstede gæld via obligationer, hvis formål er at finansiere fremtidige investeringer og/eller projekter. Sikkerheden bag en virksomhedsobligation afhænger af virksomhedens betalingsevne. Af og til sætter virksomheden fysiske aktiver som kollateral for obligationerne i tilfælde af konkurser. Ift. statsobligationer bærer virksomhedsobligationer på en langt større risiko givet kreditrisikoen i virksomheden og/eller markedet. For at påtage sig denne risiko, forlanger investorerne derfor en højere præmie i form af en højere rente tilhørende virksomhedsobligationerne. For at repræsentere virksomhedsobligationer anvendes en indeksserie af virksomhedsobligationer med lang løbetid. Data er fra [@Ibbotson2019] og hentet via [@Goyal2007]^[Mere specifickt via *Amit Goyals* hjemmeside, hvor der findes en opdateret version af dataet, som der benyttes i artiklen, se evt. [@Goyal2020].]. Det specifikke grundlag for tidsserien er tvetydigt, men [@Ibbotson2019] skriver følgende.
\begin{center}
\textit{A corporate bond series with a long maturity is used to describe fixed-income securities that contain risk of default.}
\end{center}
Log  merafkastet af virksomhedsobligationenerne beregnes som det kvartalsvise log brutto afkast fratrukket det kvartalsvise brutto afkast på den amerikanske 90-dages *T-Bill*. Som forventet ses den højere afkastpræmie med et justeret kvartalsvist afkast på `r round(DESCRIPTIVE$adj_mean[4]*100, 1)`$\%$ og en tilhørende volatilitet på `r round(DESCRIPTIVE$sd[4]*100, 1)`$\%$, som investoren får, for at påtage sig den ekstra kreditrisiko. Afkastfordelingen anses som værende relativt mest symmetrisk ift. de andre aktivklasser, hvilket også ses i en skævhedsværdi på `r round(DESCRIPTIVE$skew[4], 3)`. Med en kurtosis på mere end $3$, har fordelingen tykkere haler og med mere masse centralt i fordelingen. Det bemærkes ligeledes at virksomhedsobligationer har haft de største positive markedsudsving af de tre aktivklasser med et positivt afkast på $20.8 \%$. Figur \@ref(fig:V-OBL-tids) viser et plot over tidsserien, Figur \@ref(fig:V-OBL-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:V-OBL-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r V-OBL-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af log merafkastet på virksomhedsobligationer.', fig.width=18, fig.height=5, fig.pos='H'}
par(mfrow=c(1,1))
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$V_OBL))+
  geom_line(aes(x=index(data), y=V_OBL)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$V_OBL), max(data$V_OBL))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$rx_{t}^{v}$"))
```

```{r V-OBL-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af log merafkastet af virksomhedsobligationer.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(V_OBL), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r V-OBL-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for log merafkastet på virksomhedsobligationer.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = V_OBL)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.05, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(DATA_J$V_OBL_J), sd = sqrt(var(data$V_OBL)))) + 
  geom_vline(data=DATA_J, aes(xintercept=mean(V_OBL_J)), linetype="dashed", color ="red") + 
  expand_limits(x = 0, y = 0)+
  coord_cartesian(ylim = c(0, ceiling(max(density(data$V_OBL)$y)))) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

Tabel \@ref(tab:DES-AKTIVKLASSE) opsummerer ovenstående beskrivende statistik for de fire aktivkasser.

(ref:jb1980) [@Jarque1980]

```{r DES-AKTIVKLASSE, echo=FALSE}
options(knitr.kable.NA = '')
DESCRIPTIVE <- format(round(DESCRIPTIVE, digits = 3), nsmall = 3)
DESCRIPTIVE$sr[1] <- NA

colnames(DESCRIPTIVE) <- c('Middelværdi', 'Standard afvigelse', 'Sharpe Ratio', 'Skævhed', 'Kurtosis', 'Minimum', '$25 \\%$', 'Median', '$75 \\%$', 'Maksimum', 'AK(1)')

rownames(DESCRIPTIVE) <- c("$r_t^{\\text{rf}}$", "$rx_t^{\\text{a}}$", "$rx_t^{\\text{s}}$", "$rx_t^{\\text{v}}$")

DESCRIPTIVE %>% 
  knitr::kable(caption = 'Beskrivende statistik for de fire aktivklasser.',
               booktabs=TRUE,
               align = c(rep('r', 10)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position", "scale_down"),
                             full_width = F) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer kvartalsvis beskrivende statistik for aktivklasserne: det risikofrie aktiv, merafkastet på aktier, merafkastet på statsobligationer og merafkastet på virksomhedsobligationer. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Middelværdien er justeret for alle aktivklasser.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r JB-AKTIVKLASSE, echo=FALSE}
options(knitr.kable.NA = '')
JB <- format(round(JB, digits = 3), nsmall = 3)

colnames(JB) <- c('Teststørrelse', '$p$-værdi')

rownames(JB) <- c("$r_t^{\\text{rf}}$", "$rx_t^{\\text{a}}$", "$rx_t^{\\text{s}}$", "$rx_t^{\\text{v}}$")

JB %>% 
  knitr::kable(caption = 'Jarque-Bera test.',
               booktabs=TRUE,
               align = c(rep('r', 2)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer Jarque-Beta teststørrelser og $p$-værdier for aktivklasserne: det risikofrie aktiv, merafkastet på aktier, merafkastet på statsobligationer og merafkastet på virksomhedsobligationer, (ref:jb1980). Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018.}", threeparttable = T, escape = FALSE, general_title = "")
```

## Prædiktionsvariable{#pvariable}
Denne sektion har til formål at beskrive datagrundlaget for prædiktionsvariablene, som først blev beskrevet i Sektion ??. Disse variable består af en række finansielle indikatorer: *Dividend-Price Ratio*, *Price-Earnings Ratio*, *Book-to-market Ratio*, *High Minus Low*, *Small Minus Big*, og variansen af aktieafkast. Derudover haves rentestruktursprædiktionsvariable: den nominelle rente, *Term Spread*, *Yield Spread*, *Credit Spread* og *Default Spread*. Én makroøkonomisk variabel udgør den sidste prædiktionsvariabel: *Federal Funds Rate*. Udover beskrivelsen og begrundelsen beregningsmetoden for hver variabel, vil den tilhørende beskrivende statistik for hver variabel belyses.

### Dividend-Price Ratio -- $x_t^{\text{dp}}$
Repræsentativet for priserne til forholdet mellem udbytte og priser er indeksniveauet, eksklusiv udbytte, over det brede indeks som blev beskrevet i Sektion \@ref(dataak). Udbyttet stammer ligeledes fra aktieindekset, og er beregnet som en rullende sum over de seneste fire kvartaler. Log udbyttet er logaritmen til tidsserien over de rullende summer af udbytte. Log *Dividend-Price Ratio* bliver da beregnet som forskellen mellem det rullende kvartalsvise log udbytte og de kvartalsvise log priser. Data er fra [@CRSPakt] og hentet gennem [@WRDSakt]. Den justerede middelværdi er `r round(DESCRIPTIVE_T$mean[1], 3)`$\%$, og betyder altså at det sande forhold mellem udbytte og priser historisk har været omtrent $1$:$34$. Det andet moment er `r round(DESCRIPTIVE_T$sd[1], 3)`$\%$. Forholdet er en næsten symmetrisk med et tredje moment på `r round(DESCRIPTIVE_T$skew[1], 3)`. En kurtosis på `r round(DESCRIPTIVE_T$kurt[1], 3)` indebærer at log *Dividend Price Ratio* har en platykurtisk fordeling med sjældne ekstreme observationer. Den `r format(index(DP[which.max(DP)]), '%d %B, %Y')` var det sande forhold på sidst højeste, da det nåede `r round(exp(max(DP)), 3)*100`$\%$. Over de følgende $18$ år, dalede forholdet til `r round(exp(min(DP)), 3)*100`$\%$ den `r format(index(DP[which.min(DP)]), '%d %B, %Y')`, fordi aktieprisernes værdi steg hurtigere end udbyttebetalingerne fra indtjeningen i virksomhederne. Derudover steg offentlige virksomheders indtjening langsommere end aktiepriserne. Disse tal er konsistente med [@CampVic2003]. Figur \@ref(fig:DP-tids) viser et plot over tidsserien, Figur \@ref(fig:DP-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:DP-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r DP-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af log Dividend Price Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
par(mfrow=c(1,1))
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$DP))+
  geom_line(aes(x=index(data), y=DP)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$DP), max(data$DP))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{inf}$"))
```

```{r DP-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af log Dividend Price Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(DP), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.7, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r DP-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for log Dividend Price Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = DP)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.25, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(DATA_T_J$DP_J), sd = sqrt(var(data$DP)))) + 
  geom_vline(aes(xintercept=mean(DATA_T_J$DP_J)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 1.2)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Price-Earnings Ratio -- $x_t^{\text{pe}}$
Priserne for forholdet mellem priser og indtjening er som ovenstående indeksniveauet fra Sektion \@ref(dataak), ekslusiv udbytte. Indtjeningen er en rullende sum repræsenterende indtjeningen på *S\&P 500* indekset. Data er dermed fra hhv. [@CRSPakt], hentet gennem [@WRDSakt] og [@Shiller2020], hentet gennem [@Goyal2007]. At indtjeningen benytter et andet datagrundlag end aktieindekset kan skabe tvetydigheder i resultaterne, men prædiktabiltetsegenskaben for variablen er stadig intakt. Log *Price Earnings Ratio* bliver da beregnet som forskellen mellem de kvartalsvise log priser og de kvartalvise log indtjeninger. Den justerede middelværdi er `r round(DESCRIPTIVE_T$mean[2], 3)`$\%$. Standardafvigelsen er på `r round(DESCRIPTIVE_T$sd[2], 3)`$\%$. Derudover haves en højreskæv leptokurtisk fordeling med hhv. skævhed på `r round(DESCRIPTIVE_T$skew[2], 3)` og kurtosis på `r round(DESCRIPTIVE_T$kurt[2], 3)`. Figur \@ref(fig:PE-tids) viser et plot over tidsserien, Figur \@ref(fig:PE-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:PE-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r PE-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af log Price Earnings Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$EP))+
  geom_line(aes(x=index(data), y=EP)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$EP), max(data$EP))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{pe}$"))
```

```{r PE-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af log Price Earnings Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(EP), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.6, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r PE-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for log Price Earnings Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = EP)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.25, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(DATA_T_J$EP_J), sd = sqrt(var(data$EP)))) + 
  geom_vline(aes(xintercept=mean(DATA_T_J$EP_J)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 1.6)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Book-to-Market Ratio -- $x_t^{\text{bm}}$
*Book-to-market Ratio* er hentet gennem [@Goyal2007]. Bogførte værdier samt markedsværdier stammer fra *Value Line*'s hjemmeside, mere specifikt gennem deres *Long-Term Perspective Chart* af indekset *Dow Jones Industrial Average*. Beregningsmetoden er oprindeligt månedsbaseret og for månederne marts til december beregnes forholdet som den bogførte værdi fra slutningen af sidste år, delt med prisen fra seneste månedsultimo. For januar og februar beregnes det som den bogførte værdi fra slutningen af for to år siden, delt med prisen fra seneste månedsultimo. Beregningsmetoden er sammenlignelig med [@Kothari1997] og [@Pontiff1998]. Det første og andet moment er hhv. `r round(DESCRIPTIVE_T$mean[3], 3)` og `r round(DESCRIPTIVE_T$sd[3], 3)`. Fra tredje og fjerde moment ses højreskævhed og en mesokurtisk fordeling. [@Pontiff1998] finder første og andet moment til hhv. $0.505$ og $0.252$, hvilket validerer estimaterne. Efter 1982 ses det, at forholdet aftager kraftigt, og efter en kort tiltagning har det de seneste år stabiliseret sig. Dette kommer sig bl.a. af, at amerikanske virksomheder i stigende grad har bogført en negativ værdi, se evt. *Historical Book Equity Data* fra [@French2020]. Figur \@ref(fig:BM-tids) viser et plot over tidsserien, Figur \@ref(fig:BM-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:BM-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r BM-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af Book-to-market Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$BM))+
  geom_line(aes(x=index(data), y=BM)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$BM), max(data$BM))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{bm}$"))
```

```{r BM-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af Book-to-market Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(BM), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.8, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r BM-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for Book-to-market Ratio.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = BM)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.1, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$BM), sd = sqrt(var(data$BM)))) + 
  geom_vline(aes(xintercept=mean(BM)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 2.4)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Aktievarians -- $x_t^{\text{avar}}$
Aktievariansen består af den kvartalsvise kvadratsum af afkast, samt summen af produktet mellem to tilstødende kvartalsvise afkast. Beregningsmetoden er fra [@Schwert1987] og data er hentet gennem [@Goyal2007], som baserer estimaterne på afkast fra *S\&P 500* indekset. Selve metoden tager udgangspunkt i daglige priser fremfor kvartalsvise, for at måle det kvartalsvise aktieafkast $r_{it}$. De kvartalsvise afkast er herefter kvadreret for at etablere variansen. Herefter justeres for autokorrelation, ved at addere to gange summen af produkterne mellem alle par af foreløbende kvartalsafkast. Middelværdien estimeres til `r round(DESCRIPTIVE_T$mean[4], 3)` og med en standardafvigelse på `r round(DESCRIPTIVE_T$sd[4], 3)`. Givet ikke-negativiteten af variansen, ses forventeligt en meget højreskæv fordeling med tilhørende høj kurtosis på hhv. `r round(DESCRIPTIVE_T$skew[4], 3)` og `r round(DESCRIPTIVE_T$kurt[4], 3)`. Figur \@ref(fig:AV-tids) viser et plot over tidsserien, Figur \@ref(fig:AV-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:AV-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r AV-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af aktievariansen.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$AKT_VAR))+
  geom_line(aes(x=index(data), y=AKT_VAR)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$AKT_VAR), max(data$AKT_VAR))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{avar}$"))
```

```{r AV-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af aktievariansen.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(AKT_VAR), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r AV-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for aktievariansen.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = AKT_VAR)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.01, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$AKT_VAR), sd = sqrt(var(data$AKT_VAR)))) + 
  geom_vline(aes(xintercept=mean(AKT_VAR)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, ceiling(max(density(data$AKT_VAR)$y)))) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### High Minus Low -- $x_t^{\text{hml}}${#datahml}
Den første af de to *Fama-French* faktorer. Månedlige værdier er fra [@CRSPakt] og hentet gennem [@French2020], det er herefter omdannet til kvartalsvise værdier via et kvartalsvist rullende tre-måneders gennemsnit. Selve faktoren er baseret på: to porteføljer baseret på størrelse, hvor skillelinjen er markedsmedianen på *NYSE*, tre porteføljer baseret på *Book-to-Market Ratio*, hvor skilningerne er $30$- og $70$-percentilerne af *Book-to-Market Ratio* på *NYSE*. Herefter eksisterer der seks fællesmængder, som dermed udgør grundlaget for porteføljerne til *High Minus Low*. Selve faktoren beregnes som gennemsnittet på de to værdi-porteføljer^[Virksomheder i værdi-porteføljerne har høj *Book-to-market Ratio* og er hhv. store og små.] fratrukket det gennemsnitlige afkast på de to vækst-porteføljer^[Virksomheder i vækst-porteføljerne har lav *Book-to-market Ratio* og er hhv. store og små.]. En positiv *High Minus Low* faktor medfører, at værdi-virksomheder er mere efficiente end vækst virksomheder på lang sigt, [@French1993]. Det første og andet moment er hhv. `r round(DESCRIPTIVE_T$mean[5], 3)` og `r round(DESCRIPTIVE_T$sd[5], 3)`. Skævhed på `r round(DESCRIPTIVE_T$skew[5], 3)` og kurtosis på `r round(DESCRIPTIVE_T$kurt[5], 3)`, indikerer en forholdsvis symmetrisk fordeling. Figur \@ref(fig:HML-tids) viser et plot over tidsserien, Figur \@ref(fig:HML-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:HML-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r HML-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af High Minus Low.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$HML))+
  geom_line(aes(x=index(data), y=HML)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$HML), max(data$HML))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{hml}$"))
```

```{r HML-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af High Minus Low.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(HML), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r HML-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for High Minus Low.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = HML)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 1, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$HML), sd = sqrt(var(data$HML)))) + 
  geom_vline(aes(xintercept=mean(HML)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 0.35)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Small Minus Big -- $x_t^{\text{smb}}${#datasmb}
Den anden *Fama-French* faktor. Månedlige værdier er fra [@CRSPakt] og hentet gennem [@French2020], det er herefter omdannet til kvartalsvise værdier via et kvartalsvist rullende tre-måneders gennemsnit. Selve faktoren er baseret på de samme porteføljer som beskrevet i ovenstående Sektion \@ref(datahml). Selve faktoren beregnes som forskellen mellem de ligevægtede gennemsnitlige afkast af de små porteføljer og de store porteføljer. En positiv *Small Minus Big* faktor er også kendt som *Small Firm Effect*, og medfører, at små virksomheder er mere efficiente end store virksomheder på lang sigt, [@French1993]. Det første og andet moment er hhv. `r round(DESCRIPTIVE_T$mean[6], 3)` og `r round(DESCRIPTIVE_T$sd[6], 3)`. En skævhed på `r round(DESCRIPTIVE_T$skew[6], 3)` og kurtosis på `r round(DESCRIPTIVE_T$kurt[6], 3)`, indikerer en meget symmetrisk fordeling. Figur \@ref(fig:SMB-tids) viser et plot over tidsserien, Figur \@ref(fig:SMB-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:SMB-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r SMB-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af Small Minus Big.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$SMB))+
  geom_line(aes(x=index(data), y=SMB)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$SMB), max(data$SMB))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{smb}$"))
```

```{r SMB-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af Small Minus Big.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(SMB), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r SMB-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for Small Minus Big.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = SMB)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 1, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$SMB), sd = sqrt(var(data$SMB)))) + 
  geom_vline(aes(xintercept=mean(SMB)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 0.35)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Nominel rente -- $x_t^{\text{b}}$
Det kvartalsvise log brutto afkast på den amerikanske 90-dages *T-Bill* benyttes som en proxy for den nominelle rente. Ved at inkludere både brutto og netto log renten, inkorporeres inflation. Eftersom log inflation er forskellen mellem log brutto renten og log netto renten. Data er fra [@CRSPt90] og hentet gennem [@WRDSt90]. Den justerede middelværdi estimeres til `r round(DESCRIPTIVE_T$mean[7]*100, 3)`$\%$. Volatiliteten estimeres til `r round(DESCRIPTIVE_T$sd[7]*100, 3)`$\%$. Tredje og fjerde moment estimeres til hhv. `r round(DESCRIPTIVE_T$skew[7], 3)` og `r round(DESCRIPTIVE_T$kurt[7], 3)`. Figur \@ref(fig:B-tids) viser et plot over tidsserien, Figur \@ref(fig:B-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:B-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r B-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af log brutto afkastet på det risikofrie aktiv.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$TB))+
  geom_line(aes(x=index(data), y=TB)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$TB), max(data$TB))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{b}$"))
```

```{r B-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af log brutto afkastet på det risikofrie aktiv.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(TB), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.7, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r B-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for log brutto afkastet på det risikofrie aktiv.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = TB)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.005, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(DATA_T_J$TB_J), sd = sqrt(var(data$TB)))) + 
  geom_vline(aes(xintercept=mean(DATA_T_J$TB_J)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 60)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Term Spread -- $x_t^{\text{ts}}$
For at beregne *Term Spread* (rentespændet for den lange rente), benyttes den amerikanske $10$-årige effektive rente med konstant løbetid samt den 90-dages *T-Bill* *Secondary Market Rate*. Kvartalsvise data er hentet fra [@FRED102020] og [@FRED902020], derudover er data ikke blevet sæsonjusteret. Spændet beregnes da som
$$x_t^{\text{ts}}=Y_t^{10}-Y_t^{90},$$

hvor $Y_t^{10}$ og $Y_t^{90}$ er de to effektive renter. Dette følger metoden fra [@Campbell1991], som også argumenterer for, at ethvert rentespænd for renter med løbetider mellem $1$ måned og $10$ år, kan prædiktere rentestrukturen. Middelværdien for det lange rentespænd estimeres til `r round(DESCRIPTIVE_T$mean[8]*100, 3)`$\%$. Volatiliteten estimeres til `r round(DESCRIPTIVE_T$sd[8]*100, 3)`$\%$. Fordelingen er forholdsvis symmetrisk med skævhed og kurtosis på hhv. `r round(DESCRIPTIVE_T$skew[8], 3)` og `r round(DESCRIPTIVE_T$kurt[8], 3)`. Figur \@ref(fig:TS-tids) viser et plot over tidsserien, Figur \@ref(fig:TS-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:TS-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r TS-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af Term Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$T_SPREAD))+
  geom_line(aes(x=index(data), y=T_SPREAD)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$T_SPREAD), max(data$T_SPREAD))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{ts}$"))
```

```{r TS-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af Term Spread.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(T_SPREAD), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r TS-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for Term Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = T_SPREAD)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.01, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$T_SPREAD), sd = sqrt(var(data$T_SPREAD)))) + 
  geom_vline(aes(xintercept=mean(T_SPREAD)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 35)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Yield Spread -- $x_t^{\text{ys}}$
Datagrundlaget for *Yield Spread* (rentespændet for den korte rente) er den amerikanske $10$-årige effektive rente med konstant løbetid samt den 90-dages *T-Bill* *Secondary Market Rate*. Kvartalsvise data er hentet fra [@FRED52020] og [@FRED902020], og er ikke sæsonjusteret. Spændet beregnes da som
$$x_t^{\text{ts}}=Y_t^{5}-Y_t^{90},$$

hvor $Y_t^{5}$ og $Y_t^{90}$ er de to effektive renter. Middelværdien, `r round(DESCRIPTIVE_T$mean[9]*100, 3)`$\%$, er som forventet en anelse mindre end middelværdien for *Term Spread*. Det samme er volatiliteten, `r round(DESCRIPTIVE_T$sd[9]*100, 3)`$\%$. Fordelingen er en anelse leptokurtisk med kurtosis på  `r round(DESCRIPTIVE_T$kurt[9], 3)`. Skævheden er `r round(DESCRIPTIVE_T$skew[9], 3)`. Figur \@ref(fig:YS-tids) viser et plot over tidsserien, Figur \@ref(fig:YS-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:YS-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r YS-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af Yield Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$Y_SPREAD))+
  geom_line(aes(x=index(data), y=Y_SPREAD)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$Y_SPREAD), max(data$Y_SPREAD))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{ys}$"))
```

```{r YS-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af Yield Spread.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(Y_SPREAD), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.1, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r YS-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for Yield Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = Y_SPREAD)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.005, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$Y_SPREAD), sd = sqrt(var(data$Y_SPREAD)))) + 
  geom_vline(aes(xintercept=mean(Y_SPREAD)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 45)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Credit Spread -- $x_t^{\text{cs}}$
Beregningen til *Credit Spread* (kreditspændet) benytter den 90-dages *T-Bill* *Secondary Market Rate* samt den effektive rente fra *Moody's Seasoned BAA Corporate Bond*, og baserer sig på instrumenter med løbetider på $20$ år eller mere. Data er hentet fra hhv. [@FRED902020] samt [@Goyal2007]. Metoden følger fra [@Keim1986], og kreditspændet beregnes da som
$$x_t^{\text{cs}}=Y_t^{\text{BAA}}-Y_t^{90},$$

hvor $Y_t^{\text{BAA}}$ og $Y_t^{90}$ er de to effektive renter. Af de fem rentrestruktursvariable ses det, at kreditspændet har den højeste middelværdi på `r round(DESCRIPTIVE_T$mean[10]*100, 3)`$\%$, og en standardafvigelse på `r round(DESCRIPTIVE_T$sd[10]*100, 3)`$\%$. Tredje og fjerde moment estimeres til hhv. `r round(DESCRIPTIVE_T$skew[10], 3)` og `r round(DESCRIPTIVE_T$kurt[10], 3)`. Figur \@ref(fig:CS-tids) viser et plot over tidsserien, Figur \@ref(fig:CS-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:CS-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r CS-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af Credit Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$C_SPREAD))+
  geom_line(aes(x=index(data), y=C_SPREAD)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$C_SPREAD), max(data$C_SPREAD))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{cs}$"))
```

```{r CS-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af Credit Spread.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(C_SPREAD), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.3, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r CS-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for Credit Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = C_SPREAD)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.01, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$C_SPREAD), sd = sqrt(var(data$C_SPREAD)))) + 
  geom_vline(aes(xintercept=mean(C_SPREAD)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 25)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Default Spread -- $x_t^{\text{ds}}$
For at beregne *Default Spread* (konkursspændet) benyttes den effektive rente fra *Moody's Seasoned AAA Corporate Bond* samt den effektive rente fra *Moody's Seasoned BAA Corporate Bond*, og baserer sig begge på instrumenter med løbetider på $20$ år eller mere. Data er hentet via [@Goyal2007]. Konkursspændet beregnes da som
$$x_t^{\text{ds}}=Y_t^{\text{BAA}}-Y_t^{\text{AAA}},$$

hvor $Y_t^{\text{BAA}}$ og $Y_t^{\text{AAA}}$ er de to effektive renter. Til forskel for kreditspændet har konkursspændet den laveste middelværdi, `r round(DESCRIPTIVE_T$mean[11]*100, 3)`$\%$, også på tværs af de andre klasser af prædiktionsvariable. Standardafvigelsen er `r round(DESCRIPTIVE_T$sd[11]*100, 3)`$\%$. Af rentestruktursvariablene har konkursspændet også den hhv. mest ekstreme skævhed og kurtosis. Disse er hhv. `r round(DESCRIPTIVE_T$skew[11], 3)` og `r round(DESCRIPTIVE_T$kurt[11], 3)`, hvilket indebærer en højreskæv fordeling med tykke haler. Figur \@ref(fig:DS-tids) viser et plot over tidsserien, Figur \@ref(fig:DS-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:DS-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r DS-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af Default Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$D_SPREAD))+
  geom_line(aes(x=index(data), y=D_SPREAD)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$D_SPREAD), max(data$D_SPREAD))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{ds}$"))
```

```{r DS-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af Default Spread.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(D_SPREAD), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.4, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r DS-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for Default Spread.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = D_SPREAD)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.0025, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$D_SPREAD), sd = sqrt(var(data$D_SPREAD)))) + 
  geom_vline(aes(xintercept=mean(D_SPREAD)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 150)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

### Federal Funds Rate -- $x_t^{\text{fr}}$
I U.S.A. er *Federal Funds Rate*, renten som private finansinstitutioner tager for at låne uden sikkerhed, sædvanligvis over natten, af finansinstitutions reserver i *Federal Reserve Bank*. Data er hentet fra [@FREDF2020]. De kvartalsvis observationer er baseret på et gennemsnit af daglige observationer. Middelværdien er på `r round(DESCRIPTIVE_T$mean[12]*100, 3)`$\%$, og standardafvigelsen er på `r round(DESCRIPTIVE_T$sd[12]*100, 3)`$\%$. Tredje og fjerde moment estimeres til hhv. `r round(DESCRIPTIVE_T$skew[12], 3)` og `r round(DESCRIPTIVE_T$kurt[12], 3)`. Figur \@ref(fig:FR-tids) viser et plot over tidsserien, Figur \@ref(fig:FR-AK) viser et plot over autokorrelationen for tidsserien og Figur \@ref(fig:FR-HIST) viser et plot over histogrammet for tidsserien med tilhørende *kernel* tæthed samt tæthed for en normalfordelt stokastisk variabel med middelværdi og standard afvigelse lig ovenstående estimater.

```{r FR-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af Federal Funds Rate.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data) +
  expand_limits(x = min(index(data)), y = min(data$FR))+
  geom_line(aes(x=index(data), y=FR)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(data$FR), max(data$FR))) +
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(data)), max(index(data))))+
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  ) + 
  ylab(TeX("$x_{t}^{fr}$"))
```

```{r FR-AK, echo=FALSE, fig.align='center', fig.cap='Autokorrelation af Federal Funds Rate.', fig.width=18, fig.height=5, fig.pos='H'}
a  <- acf(as.numeric(FR), plot=FALSE)
ba <- with(a, data.frame(lag, acf))

conf_limits <- c(-1, 1) * qnorm((1 + 0.95) / 2) / sqrt(a$n.used)

ggplot(data = ba, mapping = aes(x = lag, y = acf)) +
  geom_hline(aes(yintercept = 0)) +
  geom_hline(yintercept = conf_limits, col = "pink") +
  geom_segment(mapping = aes(xend = lag, yend = 0)) +
  coord_cartesian(ylim = c(min(ba$acf)-0.7, 1)) +
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(breaks = seq(0, 25, 1)) +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r FR-HIST, echo=FALSE, fig.align='center', fig.cap='Histogram for Federal Funds Rate.', fig.width=18, fig.height=5, fig.pos='H'}
ggplot(data, aes(x = FR)) +
  geom_histogram(aes(y=..density..), color="pink", fill = "pink", binwidth = 0.025, alpha = 0.4) +
  geom_density() +
  stat_function(fun = dnorm, colour = "red", args = list(mean = mean(data$FR), sd = sqrt(var(data$FR)))) + 
  geom_vline(aes(xintercept=mean(FR)), linetype="dashed", color ="red") +
  coord_cartesian(ylim = c(0, 14)) +
  scale_y_continuous(expand=c(0,0))+
  theme_bw()+
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r DES-TILSTANDSVARIABLE, echo=FALSE}
DESCRIPTIVE_T <- format(round(DESCRIPTIVE_T, digits = 3), nsmall = 3)

colnames(DESCRIPTIVE_T) <- c('Middelværdi', 'Standard afvigelse', 'Skævhed', 'Kurtosis', 'Minimum', '$25 \\%$', 'Median', '$75 \\%$', 'Maksimum', 'AK(1)')

rownames(DESCRIPTIVE_T) <- c('$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\text{avar}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

DESCRIPTIVE_T %>% 
  knitr::kable(caption = 'Beskrivende statistik for prædiktionsvariablene.',
               booktabs=TRUE,
               align = c(rep('r', 9)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position", "scale_down"),
                             full_width = F) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer kvartalsvis beskrivende statistik for prædiktionsvariablene: log Dividend-Price Ratio, log Price-Earnings Ratio, Book-to-Market Ratio, aktievariansen, High Minus Low, Small Minus Big, log afkastet af den nominelle rente, Term Spread, Yield Spread, Credit Spread, Default Spread samt Federal Funds Rate. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Middelværdien er justeret for log Dividend-Price ratio, log Earnings-Price Ratio samt log afkastet af den nominelle rente.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r JB-TILSTANDSVARIABLE, echo=FALSE}
options(knitr.kable.NA = '')
JB_T <- format(round(JB_T, digits = 3), nsmall = 3)

colnames(JB_T) <- c('Teststørrelse', '$p$-værdi')

rownames(JB_T) <- c('$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\text{avar}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

JB_T %>% 
  knitr::kable(caption = 'Jarque-Bera test.',
               booktabs=TRUE,
               align = c(rep('r', 2)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer Jarque-Beta teststørrelser og $p$-værdier for prædiktionsvariablene: log Dividend-Price Ratio, log Price-Earnings Ratio, Book-to-Market Ratio, aktievariansen, High Minus Low, Small Minus Big, log afkastet af den nominelle rente, Term Spread, Yield Spread, Credit Spread, Default Spread samt Federal Funds Rate, (ref:jb1980). Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018.}", threeparttable = T, escape = FALSE, general_title = "")
```

## Korrelation{#korr}
Denne sektion rapporterer korrelationen mellem alle de ovennævnte variable, som inkluderer både aktivklasserne og prædtiktionsvariablene. Korrelation er opsummeret i Tabel \@ref(tab:DES-KOR). En analyse af korrelationen er en vigtig del af datainspektionen, specielt for multivariate processor -- som den introducerede VAR(1)-model fra Sektion ?? -- når den statistiske sammenhæng mellem flere variable skal uddybes. Ergo for bedre at kunne beskrive, hvordan en variabel påvirker en eller flere andre variabler, analyseres korrelationen på tværs af alle variable.

Fra Tabel \@ref(tab:DES-KOR), ses at alle log merafkast er ikke-negativt korreleret med den risikofrie netto rente. Samtidig bemærkes at korrelationen mellem obligationsmerafkastene er forholdsvis høj. Som forventet er korrelationen med den risikofrie brutto rente højest af alle variable. De finasielle variable har generelt lav korrelation med den risikofrie netto rente, det samme gør sig gældende for rentestruktursvariablene, mens den makroøkonomiske variabel *Federal Funds Rate* har højere korrelation.

Den anden række repræsenterer korrelationen med log merafkastet på aktier. Denne er negativt korreleret med log merafkastet på statsobligationer og positivt korreleret med log merafkastet på virksomhedsobligationer. Mht. prædiktionsvariablene, er den generelt en anelse negativt korreleret med de finansielle variable, mens det samme gør sig gældende for rentestruktursvariablene. Som forventet har aktievariansen en negativ korrelation med log merafkastet på aktier. *Federal Funds Rate* har ligeledes negativ korrelation.

Log merafkastet på statsobligationer er højt korreleret med log merafkastet på virksomhedsobligationer, hvilket indikerer at de har sammenlignelige egenskaber. Mht. de finansielle variable er der generelt en korrelation omkring nul. For rentestruktursvariablene ses en relativt stor positiv korrelation. Dette kunne betyde, at disse har mere statistisk styrke til at prædiktere merafkastet. For makrovariablen ses et højere kontracyklisk mønster end for log merafkastet på aktier.

Den fjerde række svarer til log merafkastet på virksomhedsobligationer. Her ses en blandet korrelation mellem de finansielle variable, mens der generelt ses en positiv korrelation mellem rentestruktursvariablene. Mht. *Federal Funds Rate* ses igen et kontracyklisk mønster, som for resten af serien af log merafkast. Fokuseres nu på prædiktionsvariablene i Tabel \@ref(tab:DES-KOR), er der generelt høj korrelation mellem de finansielle variable, med undtagelse af *Small Minus Big*, *High Minus Low* og aktievariansen. Dette kan være problematisk, da de essentielt kan indeholde samme information, til at prædiktere merafkast. Korrelationskoefficienten mellem de finansielle variable og rentestruktursvariablene er generelt lav. Den makroøkonomiske variabel har et generelt mønster af høj korrelation mellem af de andre klasser af prædiktionsvariable.

```{r DES-KOR, echo=FALSE}
DES_COR <- format(round(cor(data), digits = 2), nsmall = 2)
DES_COR[lower.tri(DES_COR)] <- NA

colnames(DES_COR) <- c("$r_t^{\\text{rf}}$", "$rx_t^{\\text{a}}$", "$rx_t^{\\text{s}}$", "$rx_t^{\\text{v}}$", '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\text{avar}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

rownames(DES_COR) <- c("$r_t^{\\text{rf}}$", "$rx_t^{\\text{a}}$", "$rx_t^{\\text{s}}$", "$rx_t^{\\text{v}}$", '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\text{avar}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

DES_COR %>% 
  knitr::kable(caption = 'Korrelationsmatricen mellem alle aktivklasser og prædiktionsvariable.',
               booktabs=TRUE,
               align = c(rep('r', ncol(cor(data)))),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position", "scale_down"),
                             full_width = F) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer korrelationsmatricen i øvre triangulær form mellem alle beskrevne variable: det risikofrie aktiv, merafkastet på aktier, merafkastet på statsobligationer, merafkastet på virksomhedsobligationer, log Dividend-Price Ratio, log Price-Earnings Ratio, Book-to-Market Ratio, aktievariansen, High Minus Low, Small Minus Big, log afkastet af den nominelle rente, Term Spread, Yield Spread, Credit Spread, Default Spread samt Federal Funds Rate. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018.}", threeparttable = T, escape = FALSE, general_title = "")
```

## Stationaritet
Som nævnt tidligere er stationaritet af de anvendte tidsserier et bærende element for validiteten af den endelige VAR(1)-model. I denne sektion vil en række testprocedure blive udført, for at kontrollere for stationaritet, på en mere formel måde end visuel inspektion. Tre forskellige test vil tilsammen skabe et grundlag for at afgøre om en eller flere af alle tilstandsvariablene skal ekskluderes fra den endelige VAR(1)-model. Disse er hhv. *Augmented Dickey-Fuller* test, *Phillips-Perron* test samt *Kwiatkowski-Phillips-Schmidt-Shin*.

### Augmented Dickey-Fuller Test
*Augmented Dickey-Fuller* test outputtet ses i Tabel \@ref(tab:STAT). Først og fremmest ses, at vi afvise hypotesen om ikke-stationaritet hos alle aktivklasserne -- på et signifikansniveau på $\alpha=0.05$ -- når fokus er på de første par lags. Dette var også forventet givet en inspektion af de relevante tidsserie plots. Fokuseres dernæst på prædiktionsvariablene er det kun *Dividend-Price Ratio*, *Book-to-Market Ratio*, den nominelle rente samt *Federal Funds Rate*, som ikke kan forkaste hypotesen om ikke-stationaritet. *Price-Earnings* kan kun forkaste hypotesen for et signifikansniveau på $\alpha=0.1$, uden lags. Hvorimod resten af prædiktionsvariablene forkaster hypotesen for alle lags. For at verificere, at de tre nævnte ovennævnte variable potentielt er eksplosive eller har en *unit root*, tages den første forskel på tidsserierne. Herefter foretages testen igen. Outputtet fra denne re-testning ses i Tabel \@ref(tab:STAT-DIFF). Som det kan aflæses i tabellen er alle variablene integreret af første orden, $I(1)$, eller stationære med hensyn til deres første forskel.

Håndteringen af potentielle ikke-stationære tidsserier er mere problematisk. Essentielt kan de problematiske variable udelades fra resten af analysen. På den anden side vil afvisning af de såkaldte *difference stationary* serier være ufornuftigt, da disse ikke kan skabe problemer for den færdige model. Den generelle statistiske metode, ville være at fortsætte analysen med brug af disse nye serier: $x_t^{\text{dp}_{\Delta}}$, $x_t^{\text{bm}_{\Delta}}$, $x_t^{\text{b}_{\Delta}}$ og $x_t^{\text{fr}_{\Delta}}$. Men flere argumenter taler til gengæld imod denne procedure. Først og fremmest er det generelt accepteret i litteraturen at anvende disse variable i niveauer. For det andet vil mange variable miste deres intuitive prædiktionskvaliteter, da deres niveau er en del af argumentationen for at medtage dem. For det tredje vides det fra økonomisk intuition, at disse variable ikke kan blive eksplosive af konstruktion.

(ref:df1979) [@Dickey1979]
(ref:kpss1992) [@Kwiatkowski1992]
(ref:pp1988) [@Phillips1988]
(ref:sc1989) [@Schwert1989]

```{r STAT, echo=FALSE}
options(knitr.kable.NA = '')

STAT_TABLE <- format(round(STAT_TABLE, digits = 3), nsmall = 3)

colnames(STAT_TABLE) <- rep(c('Teststørrelse', '$p$-værdi'),6)

rownames(STAT_TABLE) <- c("$r_t^{\\text{rf}}$", "$rx_t^{\\text{a}}$", "$rx_t^{\\text{s}}$", "$rx_t^{\\text{v}}$", '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\text{avar}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

STAT_TABLE %>% 
  knitr::kable(caption = 'Augmented Dickey-Fuller.',
               booktabs=TRUE,
               align = c(rep('r', 10)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position", "scale_down"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "$\\\\delta=0$" = 2, "$\\\\delta=1$" = 2, "$\\\\delta=2$" = 2, "$\\\\delta=3$" = 2, "$\\\\delta=4$" = 2, "$\\\\delta^*=5$"=2), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer Augmented Dickey-Fuller teststørrelser og $p$-værdier for alle beskrevne variable: det risikofrie aktiv, merafkastet på aktier, merafkastet på statsobligationer, merafkastet på virksomhedsobligationer, log Dividend-Price Ratio, log Price-Earnings Ratio, Book-to-Market Ratio, aktievariansen, High Minus Low, Small Minus Big, log afkastet af den nominelle rente, Term Spread, Yield Spread, Credit Spread, Default Spread samt Federal Funds Rate, (ref:df1979). Testen er udført for forskellige lags, samt et lag, $\\\\delta^*$, fastsat til heltalsdelen af $4(T/100)^{1/4}$ -- som foreslået af (ref:sc1989) -- hvor $T=259$. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r STAT-DIFF, echo=FALSE}
options(knitr.kable.NA = '')

STAT_TABLE_DIFF <- format(round(STAT_TABLE_DIFF, digits = 3), nsmall = 3)

colnames(STAT_TABLE_DIFF) <- rep(c('Teststørrelse', '$p$-værdi'),6)

rownames(STAT_TABLE_DIFF) <- c('$x_t^{\\text{dp}_{\\Delta}}$', '$x_t^{\\text{bm}_{\\Delta}}$', '$x_t^{\\text{b}_{\\Delta}}$', '$x_t^{\\text{fr}_{\\Delta}}$')

STAT_TABLE_DIFF %>% 
  knitr::kable(caption = 'Augmented Dickey-Fuller. For første forskelle.',
               booktabs=TRUE,
               align = c(rep('r', 10)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position", "scale_down"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "$\\\\delta=0$" = 2, "$\\\\delta=1$" = 2, "$\\\\delta=2$" = 2, "$\\\\delta=3$" = 2, "$\\\\delta=4$" = 2, "$\\\\delta^*=5$"=2), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer Augmented Dickey-Fuller teststørrelser og $p$-værdier for 'first-difference'-variablene: log Dividend-Price Ratio, Book-to-Market Ratio, log afkastet af den nominelle rente samt Federal Funds Rate, (ref:df1979). Testen er udført for forskellige lags, samt et lag, $\\\\delta^*$, fastsat til heltalsdelen af $4(T/100)^{1/4}$ -- som foreslået af (ref:sc1989) -- hvor $T=259$. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018.}", threeparttable = T, escape = FALSE, general_title = "")
```

### Phillips-Perron test
Som en validering af resultaterne fra *Augmented Dickey Fuller* test, foretages *Phillips-Perron* testen. Outputtet fra denne ses i Tabel \@ref(tab:STAT-PP). Igen er det *Dividend-Price Ratio*, *Book-to-Market Ratio*, den nominelle rente samt *Federal Funds Rate*, som er problematiske.

```{r STAT-PP, echo=FALSE}
options(knitr.kable.NA = '')

STAT_TABLE_PP <- format(round(STAT_TABLE_PP, digits = 3), nsmall = 3)

colnames(STAT_TABLE_PP) <- rep(c('Teststørrelse', '$p$-værdi'), 2)

rownames(STAT_TABLE_PP) <- c("$r_t^{\\text{rf}}$", "$rx_t^{\\text{a}}$", "$rx_t^{\\text{s}}$", "$rx_t^{\\text{v}}$", '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\text{avar}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

STAT_TABLE_PP %>% 
  knitr::kable(caption = 'Phillips-Perron Test.',
               booktabs=TRUE,
               align = c(rep('r', 2)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "$Z(\\\\hat{\\\\alpha})$" = 2, "$Z(t_{\\\\hat{\\\\alpha}})$" = 2), escape = FALSE) %>% 
  kableExtra::add_header_above(c(" ", "$l=5$" = 4), escape = FALSE) %>% 
  kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer Phillips-Perron teststørrelser og $p$-værdier for alle beskrevne variable: det risikofrie aktiv, merafkastet på aktier, merafkastet på statsobligationer, merafkastet på virksomhedsobligationer, log Dividend-Price Ratio, log Price-Earnings Ratio, Book-to-Market Ratio, aktievariansen, High Minus Low, Small Minus Big, log afkastet af den nominelle rente, Term Spread, Yield Spread, Credit Spread, Default Spread samt Federal Funds Rate, (ref:pp1988). Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Testen er udført for et lag fastsat til heltalsdelen af $4(T/100)^{1/4}$ -- som foreslået af (ref:sc1989) -- hvor $T=259$.}", threeparttable = T, escape = FALSE, general_title = "")
```

### Kwiatkowski-Phillips-Schmidt-Shin test
Som en ekstra validering foretages *Kwiatkowski-Phillips-Schmidt-Shin* testen. Nulhypotesen er i dette tilfælde omvendt. Outputtet fra testen ses i Tabel \@ref(tab:STAT-KPSS). Det ses, at *KPSS* testen modsiger resultaterne fra både *Augmented Dickey-Fuller* testen og *Phillips-Perron* testen, for visse variable. Dette er imidlertid et kendt problem, som generelt opstår grundet en begrænset stikprøvestørrelse.

```{r STAT-KPSS, echo=FALSE}
options(knitr.kable.NA = '')

STAT_TABLE_KPSS <- format(round(STAT_TABLE_KPSS, digits = 3), nsmall = 3)

colnames(STAT_TABLE_KPSS) <- rep(c('Teststørrelse (LM)', '$p$-værdi'), 2)

rownames(STAT_TABLE_KPSS) <- c("$r_t^{\\text{rf}}$", "$rx_t^{\\text{a}}$", "$rx_t^{\\text{s}}$", "$rx_t^{\\text{v}}$", '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\text{avar}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

STAT_TABLE_KPSS %>% 
  knitr::kable(caption = 'Kwiatkowski-Phillips-Schmidt-Shin Test.',
               booktabs=TRUE,
               align = c(rep('r', 4)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "Level" = 2, "Trend" = 2)) %>% 
  kableExtra::add_header_above(c(" ", "$l=5$" = 4), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer Kwiatkowski-Phillips-Schmidt-Shin teststørrelser og $p$-værdier for alle beskrevne variable: det risikofrie aktiv, merafkastet på aktier, merafkastet på statsobligationer, merafkastet på virksomhedsobligationer, log Dividend-Price Ratio, log Price-Earnings Ratio, Book-to-Market Ratio, aktievariansen, High Minus Low, Small Minus Big, log afkastet af den nominelle rente, Term Spread, Yield Spread, Credit Spread, Default Spread samt Federal Funds Rate, (ref:kpss1992). Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Testen er udført for et lag fastsat til heltalsdelen af $4(T/100)^{1/4}$ -- som foreslået af (ref:sc1989) -- hvor $T=259$.}", threeparttable = T, escape = FALSE, general_title = "")
```

## Opsummering{#ops}
Dette kapitel fungerede som en detaljeret data beskrivelse af alle undersøgte variable inkluderet til den videre analyse. Kapitlet indeholdte både beskrivende statistik samt plots og derudover beregninger og estimationsprocedure. Inspektion af autokorrelation i hver variabel viste, at log merafkastene ikke er udsat for autokorrelation, mens det risikofrie afkast udviser en smule autokorrelation. Derimod viste stort set alle prædiktionsvariable høj autokorrelation som generelt næsten var lig $1$. Dette betyder at de generelt er meget vedvarende over tid. Dette kunne blive et problem for den videre analyse, idet, at de potentielt kan medfører bias pga. den endelige stikprøvestørrelse. En kvantitativ og kvalitativ vurdering af normaliteten af alle variable indebar, at næsten alle variable ikke udviser normalitet, dette kan tilgengæld være påvirket af stikprøvestørrelsen. Korrelationer blandt alle variable, følger generelt andre fund i eksisterende litteratur. Sidst foretog kapitlet en analyse af den mulige stationaritet blandt alle variable.

# Prædiktabilitet
Dette kapitel har til formål at teste for prædiktabilitet af afkastene i de introducerede aktivklasser fra Sektion \@ref(aktivklasser), ved benyttelse af de introducerede mulige prædiktionsvariable fra Sektion \@ref(pvariable). Prædiktabiliteten bliver testet i både et univariat og et multipelt øjemed. Dette tillader at teste for robusthed på tværs af prædiktionsvariablene og drage inferens af den mulige linearitet imellem merafkastene på aktivklasserne og de forklarende variable. Derudover vil testene giver et fingerpeg om graden af variationsforklaring, som de individuelle prædiktionsvariable måtte have, ift. responsvariablene. Disse regressioner vil have til formål at bidrage til delmængden af variable, som senere skal indgå i variabeludvælgelsen for VAR(1)-modellen. Det primære fokus vil være på de fundamentale variable, som før har vist særlig prædiktabilitets evner. Sekundært vil koefficienter, fortegn samt signifikans for hver individuel variabel blive beskrevet.

Kapitlets opbygning er som følger: Sektion \@ref(unireg) beskriver og diskuterer de univariate regressioner, Sektion \@ref(multreg) beskriver og diskuterer de multiple regressioner sidst vil Sektion \@ref(opsreg) en opsummering af kapitlets fund.

## Univariate regressioner {#unireg}

Denne sektion rapporterer de univariate regressioner af responsvariable fra Sektion \@ref(aktivklasser) på sættet af prædiktionsvariable fra Sektion \@ref(pvariable). Afskæringer bliver ikke rapporteret, eftersom det kun er den mulige prædiktabilitets evne, som har interesse for analysen. Standardfejl er justeret for heteroskedasticitet og autokorrelation, [@Newey1987]. $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. Signifikansniveauet fastholdes på niveauet $\alpha=0.05$. 

Den univariate analyse består af følgende regressioner
$$rx_{t+1}^j=\beta_{0}^i+\beta_{1}^ix_{t}^i+\varepsilon_{t+1}^i,$$

hvor $j$ er notationen for de $3$ aktivklasser bestående af merafkast og $i$ er notationen for de $12$ prædiktionsvariable. Den statistiske signifikans for hver individuel koefficient vil kort blive vurderet, da dette vil give et fingerpeg om den mulige styrke, for hver forklarende variabel ift. prædiktion af fremtidige afkast. Mest opmærksomhed vil dog stadig være på aktivklassernes fundamentale relation til visse variable.

Tabel \@ref(tab:UNI-ak) rapporterer de univariate regressions resultater af log merafkastet på aktier, $rx_{t+1}^a$, overfor den introducerede delmængde af mulige prædiktionsvariable. Det kendte nøgletal *Dividend-Price Ratio* er ikke signifikant for hverken et $5\%$ eller $10\%$ signifikansniveau, med en tilhørende $t$-størrelse på `r  round(FIT_TABLE$t[1], 3)`. Af de resterende finansielle variable er det *Price-Earnings Ratio*, *Book-to-Market Ratio*, *High Minus Low* og *Small Minus Big* som prædiktrer merafkastet på aktier negativt. Af disse er det kun *Small Minus Big* som påviser signifikans, med en $t$-størrelse på `r  round(FIT_TABLE$t[6], 3)`. Fortegnene for de finansielle variable er ækvivalente med tidligere i fund i litteraturen, eksempelvis [@Camp1987] og [@CampVicCha2003]. Den sidste signifikante variabel er *Term-Spread* med $t$-størrelse på `r  round(FIT_TABLE$t[8], 3)`. På et $10\%$ signifikansniveau vil også *Yield Spread* være statistisk signifikant, og kunne derfor også være en mulig variabel til prædiktion af merafkastet på aktier. Størstedelen af rentestrukturs variablene prædikterer merafkastet positivt, med undtagelse af den nominelle rente og *Default Spread*. Hvilket for rentespændende er ensbetydende med, at når spændet mellem langsigtede instrumenter og kortsigtede instrumenter stiger, vil en øgning i merafkastet på aktier, $rx_{t+1}^s$, ligeledes ske i den næstkommende periode.

(ref:nw1987) [@Newey1987]

```{r UNI-ak, echo=FALSE}
options(knitr.kable.NA = '')

FIT_TABLE <- format(round(FIT_TABLE, digits = 3), nsmall = 3)

FIT_TABLE <- FIT_TABLE %>%
  mutate(coef = cell_spec(coef,"latex", bold = ifelse(p <= 0.05, T, F)))
  
rownames(FIT_TABLE) <- c('$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\sigma_{\\text{a}}^2}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

colnames(FIT_TABLE) <- c('Koefficient', 'Nedre', 'Øvre', 'Standardfejl', '$t$-værdi', '$p$', '$R^2$')

FIT_TABLE %>% 
  knitr::kable(caption = 'Univariat prædiktabilitet af merafkastet på aktier.',
               booktabs=TRUE,
               align = c(rep('r', 8)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c("$rx_{t+1}^{\\\\text{a}}$", " " = 1, "Konfidensinterval" = 2, " " = 4), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af de univariate regressioner ift. responsvariablen: merafkastet på aktier, $rx_{t+1}^{\\\\text{a}}$. Hver række svarer til én selvstændig regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

Ligedes rapporterer Tabel \@ref(tab:UNI-s) de univariate regressions resultater af log merafkastet på statsobligationer, $rx_{t+1}^s$, overfor den introducerede delmængde af mulige prædiktionsvariable. Mest overraskende er, at *Yield Spread* ikke er signifikant, som den eneste af de fire rentespænds variable. Til gengæld prædikterer *Yield Spread* merafkastet på statsobligationer positivt, hvilket også følger tidligere litteratur, [@Fama1987]. Dette er også tilfældet for de resterende rentespænd. Af alle rentestruktursvariablene er det kun *Term Spread*, *Credit Spread* og *Default Spread* som er signifikante for denne stikprøve, med $t$-størrelser på hhv. `r  round(FIT_S_TABLE$t[8], 3)`, `r  round(FIT_S_TABLE$t[10], 3)` og `r  round(FIT_S_TABLE$t[11], 3)`. En stigning i den nuværende *Term Spread* kommer eksempelvis enten fra en forøgelse af den lange effektive rente, $Y_t^{10}$, eller et fald i den korte effektive rente, $Y_t^90$, eller en kombination af begge vil lede til en stigning i det fremtidige log merafkast på statsobligationer. Ift. de finansielle variable er det *Small Minus Big*, som har statistisk styrke i den univariate opsætning, med $t$-størrelse på `r  round(FIT_S_TABLE$t[6], 3)`. *Small Minus Big* prædikterer merafkastet negativt. Den makroøkonomiske variabel *Federal Funds Rate* er ikke signifikant, og prædikterer merafkastet negativt.

```{r UNI-s, echo=FALSE}
options(knitr.kable.NA = '')

FIT_S_TABLE <- format(round(FIT_S_TABLE, digits = 3), nsmall = 3)

FIT_S_TABLE <- FIT_S_TABLE %>%
  mutate(coef = cell_spec(coef, "latex", bold = ifelse(p <= 0.05, T, F)))

colnames(FIT_S_TABLE) <- c('Koefficient', 'Nedre', 'Øvre', 'Standardfejl', '$t$-værdi', '$p$', '$R^2$')

rownames(FIT_S_TABLE) <- c('$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\sigma_{\\text{a}}^2}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

FIT_S_TABLE %>% 
  knitr::kable(caption = 'Univariat prædiktabilitet af merafkastet på statsobligationer.',
               booktabs=TRUE,
               align = c(rep('r', 5)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c("$rx_{t+1}^{\\\\text{s}}$", " " = 1, "Konfidensinterval" = 2, " " = 4), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af de univariate regressioner ift. responsvariablen: merafkastet på statsobligationer, $rx_{t+1}^{\\\\text{s}}$. Hver række svarer til én selvstændig regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

De statistiske resultater for de univariate regressioner på det fremtidige log merafkast på virksomhedsobligationer, $rx_{t+1}^v$, er rapporteret i Tabel \@ref(tab:UNI-v). Igen ses, at alle rentespænd prædikterer merafkastet positivt, og alle er signifikante på $5\%$-niveauet, specielt *Credit Spread* med en $t$-størrelse på `r  round(FIT_V_TABLE$t[10], 3)`. Den samme inferens for $rx_{t+1}^s$ kan blive udtænkt for $rx_{t+1}^v$. Alle de finansielle variable, med undtagelse af *Small Minus Big*, har ikke styrke til at forklare variationen i det fremtidige log merafkast på virksomhedsobligationer. Den makroøkonomiske variabel *Federal Funds Rate* prædikterer merafkastet negativt, som også var tilfældet for statsobligations merafkastet, men denne gang er koefficienten signifikant med en $t$-størrelse på `r  round(FIT_V_TABLE$t[12], 3)`.

```{r UNI-v, echo=FALSE}
options(knitr.kable.NA = '')
FIT_V_TABLE <- format(round(FIT_V_TABLE, digits = 3), nsmall = 3)

FIT_V_TABLE <- FIT_V_TABLE %>%
  mutate(coef = cell_spec(coef, "latex", bold = ifelse(p <= 0.05, T, F)))

colnames(FIT_V_TABLE) <- c('Koefficient', 'Nedre', 'Øvre', 'Standardfejl', '$t$-værdi', '$p$', '$R^2$')

rownames(FIT_V_TABLE) <- c('$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\sigma_{\\text{a}}^2}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

FIT_V_TABLE %>% 
  knitr::kable(caption = 'Univariat prædiktabilitet af merafkastet på virksomhedsobligationer',
               booktabs=TRUE,
               align = c(rep('r', 5)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c("$rx_{t+1}^{\\\\text{v}}$", " " = 1, "Konfidensinterval" = 2, " " = 4), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af de univariate regressioner ift. responsvariablen: merafkastet på virksomhedsobligationer, $rx_{t+1}^{\\\\text{v}}$. Hver række svarer til én selvstændig regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

De ovenstående præsenterede univariate regressioner kaster tvivl på validiteten af resultater i artikler, som taler for et bredt sæt af prædiktionsvariable. Derudover indikerer de univariate regressioner, at risikoen for stikprøveafhængighed også skal medtages i konstruktionen af den endelige VAR(1)-model, hvilket også bliver understreget af [@Goyal2007]. Samtidig kan disse simple regressioner ikke stå alene om en endelig konklusion, og derfor foretages en mere kompleks multipel regressions analyse i næste sektion, som foreslået af [@Goyal2007].

## Multiple regressioner {#multreg}
I denne sektion fortsættes analysen af variablene, som kan indgå i den endelige VAR(1)-model, ved brug af multiple regressioner. Altså antages det, at en eller flere variable forklarer variationen i log merafkastet på aktivklasserne. I det følgende vil tre robuste OLS estimationer blive undersøgt nærmere, idet, at standardfejl er justeret for heteroskedasticitet og autokorrelation, [@Newey1987]. $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. Signifikansniveauet fastholdes på niveauet $\alpha=0.05$. At inkludere alle variable i én multipel regression betegnes undertiden i litteraturen med det velvalgte navn *Kitchen-Sink Regression*, [@Goyal2007].

Fokuseres først på log merafkastet på aktier, bemærkes det, at næsten alle de finansielle variable er yderst insignifikante. Kun *Small Minus Big* kan prædiktere merafkastet signifikant, hvilket stemmer overens med den univariate analyse. Dette gør den med en negativ koefficient, som også er gældende for *Price-Earnings Ratio* og *High Minus Low*. Hvorimod resten af de finansielle variable har en positiv koefficient. Ift. rentestruktursvariablene ses at den nominelle rente er signifikant med en $t$-størrelse på `r round(FIT_M_TABLE$t[8], 3)`. Den nominelle rente var til gengæld ikke signifikant i den univariate analyse. Den makroøkonomiske variabel er ligeledes signifikant -- med en $t$-størrelse på `r round(FIT_M_TABLE$t[13], 3)` -- hvilket den også var i det univariate setup. 

```{r MULT-ak, echo=FALSE}
options(knitr.kable.NA = '')

FIT_M_TABLE <- format(round(FIT_M_TABLE, digits = 3), nsmall = 3)
  
FIT_M_TABLE <- FIT_M_TABLE %>%
  mutate(coef = cell_spec(coef, "latex", bold = ifelse(p <= 0.05, T, F)))

colnames(FIT_M_TABLE) <- c('Koefficient', 'Nedre', 'Øvre', 'Standardfejl', '$t$-værdi', '$p$')

rownames(FIT_M_TABLE) <- c('Afskæring', '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\sigma_{\\text{a}}^2}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

FIT_M_TABLE %>% 
  knitr::kable(caption = 'Multipel prædiktabilitet af merafkastet på aktier.',
               booktabs=TRUE,
               align = c(rep('r', 15)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F)  %>% 
   kableExtra::add_header_above(c("$rx_{t+1}^{\\\\text{a}}$", " " = 1, "Konfidensinterval" = 2, " " = 3), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af den multiple regression ift. responsvariablen: merafkastet på aktier, $rx_{t+1}^{\\\\text{a}}$. Hver række repræsenterer et led i den mutiple regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

Som et modeltjek viser Figur \@ref(fig:MULT-ak-auto) seks af de mest sædvanlige modelinspektionsplots. Disse indebærer bl.a. residualer, standardiserede residualer, *Normal Q-Q* m.fl. Her observeres heteroskedasticitet observeres svagt for lave og høje værdier af responsvariablen. Dette indikeres bl.a. af den røde linje på *Scale-Location* plottet. Dette er højst sandsynligt grundet den meget lave stiksprøvestørrelse. På *Normal Q-Q* plottet ses igen -- som indikeret af *Jarque-Bera* testen fra Tabel \@ref(tab:JB-AKTIVKLASSE) -- at residualerne ikke følger en normalfordeling, hvor særligt problemerne er i halerne som forventet. Statistisk set er en såkaldt *outlier* ikke nødvendigvis betydningsfuld for modellen. For at være betydningsfuld for den estimerede model, skal en observation have både høj *leverage* og en høj standardiseret residual. Dette gør sig særligt gældende for to dage under *Finanskrisen*, samt dagen for et af historiens største aktiefald, *Black Monday*. Disse er også indikeret målet *Cook's Distance*, [@Cook1977], som giver høje værdier til betydningsfulde observationer.

```{r MULT-ak-auto, echo=FALSE, fig.align='center', fig.cap='Visuel inspektion af Kitchen-Sink regressionen for merafkastet på aktier.', fig.width=18, fig.asp=0.9, fig.pos='H'}
g <- autoplot(fit_AKT, which = 1:6, ncol = 2, label.size = 3, smooth.colour  = 'red', smooth.linetype = "dashed", ad.colour = "pink", label.vjust = -0.3, label.angle = -15) + theme_bw()

xLabs <- c("Fittede værdier", "Standardiserede residualer", "Fittede værdier", "Observations nummer", "Leverage", "Leverage")
yLabs <- c("Residualer", "Teoretiske kvantiler", TeX("\\sqrt{Standardiserede residualer}"), "Cook's Distance", "Standardiserde residualer", "Cook's Distance")

# loop over all plots and modify each individually
for (i in 1:6) {
    g[i] <- g[i] + xlab(xLabs[i]) + ylab(yLabs[i])
}

g
```

Figur \@ref(fig:MULT-ak-step-auto) viser ligeledes seks af de mest sædvanlige modelinspektionsplots. Disse er dannet på baggrund af en *Step AIC*-procedure. Hvor variablene iterativt er blevet fjernet fra *Kitchen-Sink* regressionen, afhængig af om de gav anledning til en bedre model ved fjernelse. Overordnet set er det de samme tendenser der ses som i Figur \@ref(fig:MULT-ak-auto). Enkelte nye observations bliver fanget af *Cook's Distance*.

```{r MULT-step-ak, echo=FALSE}
options(knitr.kable.NA = '')

FIT_M_STEP_TABLE <- format(round(FIT_M_STEP_TABLE, digits = 3), nsmall = 3)
  
FIT_M_STEP_TABLE <- FIT_M_STEP_TABLE %>%
  mutate(coef = cell_spec(coef, "latex", bold = ifelse(p <= 0.05, T, F)))

colnames(FIT_M_STEP_TABLE) <- c('Koefficient', 'Nedre', 'Øvre', 'Standardfejl', '$t$-værdi', '$p$')

rownames(FIT_M_STEP_TABLE) <- c('Afskæring', '$x_t^{\\text{bm}}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{fr}}$')

FIT_M_STEP_TABLE %>% 
  knitr::kable(caption = 'Step optimeret multipel prædiktabilitet af merafkastet på aktier.',
               booktabs=TRUE,
               align = c(rep('r', 15)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F)  %>% 
   kableExtra::add_header_above(c("$rx_{t+1}^{\\\\text{a}}$", " " = 1, "Konfidensinterval" = 2, " " = 3), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af den multiple regression ift. responsvariablen: merafkastet på aktier, $rx_{t+1}^{\\\\text{a}}$. Hver række repræsenterer et led i den mutiple regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r MULT-ak-step-auto, echo=FALSE, fig.align='center', fig.cap='Visuel inspektion af den step optimerede regression for merafkastet på aktier.', fig.width=18, fig.asp=0.9, fig.pos='H'}
g <- autoplot(step_AKT_model, which = 1:6, ncol = 2, label.size = 3, smooth.colour  = 'red', smooth.linetype = "dashed", ad.colour = "pink", label.vjust = -0.3, label.angle = -15) + theme_bw()

xLabs <- c("Fittede værdier", "Standardiserede residualer", "Fittede værdier", "Observations nummer", "Leverage", "Leverage")
yLabs <- c("Residualer", "Teoretiske kvantiler", TeX("\\sqrt{Standardiserede residualer}"), "Cook's Distance", "Standardiserde residualer", "Cook's Distance")

# loop over all plots and modify each individually
for (i in 1:6) {
    g[i] <- g[i] + xlab(xLabs[i]) + ylab(yLabs[i])
}

g
```

Mht. log merafkastet på statsobligationer ses, at *Small Minus Big* samt aktievariansen prædikterer merafkastet negativt, og som de eneste af finansielle variable, er de signifikante. For rentestruktursvariablene er det den nominelle rente samt *Credit Spread*, som er signifikante, de prædikterer afkastet positivt. Her skal det nævnes, at der er stor sandsynlighed for multikollinaritet, da rentespændene indeholder meget af den samme information og er stærkt korrelerede. Derudover kan det nævnes at *Credit Spread* er den eneste renstespændsvariabel med det korrekte fortegn. *Federal Funds Rate* er ligeledes signifikant og bevæger sig kontracyklisk med en negativ koefficient.

```{r MULT-s, echo=FALSE}
options(knitr.kable.NA = '')

FIT_M_S_TABLE <- format(round(FIT_M_S_TABLE, digits = 3), nsmall = 3)
  
FIT_M_S_TABLE <- FIT_M_S_TABLE %>%
  mutate(coef = cell_spec(coef, "latex", bold = ifelse(p <= 0.05, T, F)))

colnames(FIT_M_S_TABLE) <- c('Koefficient', 'Nedre', 'Øvre', 'Standardfejl', '$t$-værdi', '$p$')

rownames(FIT_M_S_TABLE) <- c('Afskæring', '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\sigma_{\\text{a}}^2}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

FIT_M_S_TABLE %>% 
  knitr::kable(caption = 'Multipel prædiktabilitet af merafkastet på statsobligationer.',
               booktabs=TRUE,
               align = c(rep('r', 15)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F)  %>% 
   kableExtra::add_header_above(c("$rx_{t+1}^{\\\\text{s}}$", " " = 1, "Konfidensinterval" = 2, " " = 3), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af den multiple regression ift. responsvariablen: merafkastet på statsobligationer, $rx_{t+1}^{\\\\text{s}}$. Hver række repræsenterer et led i den mutiple regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r MULT-s-auto, echo=FALSE, fig.align='center', fig.cap='Visuel inspektion af Kitchen-Sink regressionen for merafkastet på aktier.', fig.width=18, fig.asp=0.9, fig.pos='H'}
g <- autoplot(fit_S_OBL, which = 1:6, ncol = 2, label.size = 3, smooth.colour  = 'red', smooth.linetype = "dashed", ad.colour = "pink", label.vjust = -0.3, label.angle = -15) + theme_bw()

xLabs <- c("Fittede værdier", "Standardiserede residualer", "Fittede værdier", "Observations nummer", "Leverage", "Leverage")
yLabs <- c("Residualer", "Teoretiske kvantiler", TeX("\\sqrt{Standardiserede residualer}"), "Cook's Distance", "Standardiserde residualer", "Cook's Distance")

# loop over all plots and modify each individually
for (i in 1:6) {
    g[i] <- g[i] + xlab(xLabs[i]) + ylab(yLabs[i])
}

g
```

```{r MULT-s-step-auto, echo=FALSE, fig.align='center', fig.cap='Visuel inspektion af den step optimerede regression for merafkastet på aktier.', fig.width=18, fig.asp=0.9, fig.pos='H'}
g <- autoplot(step_S_OBL_model, which = 1:6, ncol = 2, label.size = 3, smooth.colour  = 'red', smooth.linetype = "dashed", ad.colour = "pink", label.vjust = -0.3, label.angle = -15) + theme_bw()

xLabs <- c("Fittede værdier", "Standardiserede residualer", "Fittede værdier", "Observations nummer", "Leverage", "Leverage")
yLabs <- c("Residualer", "Teoretiske kvantiler", TeX("\\sqrt{Standardiserede residualer}"), "Cook's Distance", "Standardiserde residualer", "Cook's Distance")

# loop over all plots and modify each individually
for (i in 1:6) {
    g[i] <- g[i] + xlab(xLabs[i]) + ylab(yLabs[i])
}

g
```

Sidst ses i Tabel \@ref(tab:MULT-v) at log merafkastet på virksomhedsobligationer er svært prædiktabelt i det multiple setup. Kun *Small Minus Big* samt *Federal Funds Rate* er signifikante med $t$-størrelser på hhv. `r round(FIT_M_V_TABLE$t[7], 3)` og `r round(FIT_M_V_TABLE$t[13], 3)`. Igen ses at *Credit Spread* er rentespændsvariablen, der har højest signifikans, hvilket følger den multiple regression mht. statsobligationerne. 

```{r MULT-v, echo=FALSE}
options(knitr.kable.NA = '')

FIT_M_V_TABLE <- format(round(FIT_M_V_TABLE, digits = 3), nsmall = 3)
  
FIT_M_V_TABLE <- FIT_M_V_TABLE %>%
  mutate(coef = cell_spec(coef, "latex", bold = ifelse(p <= 0.05, T, F)))

colnames(FIT_M_V_TABLE) <- c('Koefficient', 'Nedre', 'Øvre', 'Standardfejl', '$t$-værdi', '$p$')

rownames(FIT_M_V_TABLE) <- c('Afskæring', '$x_t^{\\text{dp}}$', '$x_t^{\\text{pe}}$', '$x_t^{\\text{bm}}$', '$x_t^{\\sigma_{\\text{a}}^2}$', '$x_t^{\\text{hml}}$', '$x_t^{\\text{smb}}$', '$x_t^{\\text{b}}$', '$x_t^{\\text{ts}}$', '$x_t^{\\text{ys}}$', '$x_t^{\\text{cs}}$', '$x_t^{\\text{ds}}$', '$x_t^{\\text{fr}}$')

FIT_M_V_TABLE %>% 
  knitr::kable(caption = 'Multipel prædiktabilitet af merafkastet på virksomhedsobligationer',
               booktabs=TRUE,
               align = c(rep('r', 15)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F)  %>% 
   kableExtra::add_header_above(c("$rx_{t+1}^{\\\\text{v}}$", " " = 1, "Konfidensinterval" = 2, " " = 3), escape = FALSE) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af den multiple regression ift. responsvariablen: merafkastet på virksomhedsobligationer, $rx_{t+1}^{\\\\text{v}}$. Hver række repræsenterer et led i den mutiple regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r MULT-v-auto, echo=FALSE, fig.align='center', fig.cap='Visuel inspektion af Kitchen-Sink regressionen for merafkastet på aktier.', fig.width=18, fig.asp=0.9, fig.pos='H'}
g <- autoplot(fit_V_OBL, which = 1:6, ncol = 2, label.size = 3, smooth.colour  = 'red', smooth.linetype = "dashed", ad.colour = "pink", label.vjust = -0.3, label.angle = -15) + theme_bw()

xLabs <- c("Fittede værdier", "Standardiserede residualer", "Fittede værdier", "Observations nummer", "Leverage", "Leverage")
yLabs <- c("Residualer", "Teoretiske kvantiler", TeX("\\sqrt{Standardiserede residualer}"), "Cook's Distance", "Standardiserde residualer", "Cook's Distance")

# loop over all plots and modify each individually
for (i in 1:6) {
    g[i] <- g[i] + xlab(xLabs[i]) + ylab(yLabs[i])
}

g
```

```{r MULT-v-step-auto, echo=FALSE, fig.align='center', fig.cap='Visuel inspektion af den step optimerede regression for merafkastet på aktier.', fig.width=18, fig.asp=0.9, fig.pos='H'}
g <- autoplot(step_V_OBL_model, which = 1:6, ncol = 2, label.size = 3, smooth.colour  = 'red', smooth.linetype = "dashed", ad.colour = "pink", label.vjust = -0.3, label.angle = -15) + theme_bw()

xLabs <- c("Fittede værdier", "Standardiserede residualer", "Fittede værdier", "Observations nummer", "Leverage", "Leverage")
yLabs <- c("Residualer", "Teoretiske kvantiler", TeX("\\sqrt{Standardiserede residualer}"), "Cook's Distance", "Standardiserde residualer", "Cook's Distance")

# loop over all plots and modify each individually
for (i in 1:6) {
    g[i] <- g[i] + xlab(xLabs[i]) + ylab(yLabs[i])
}

g
```

## Opsummering {#opsreg}

# Underliggende model

# Problemer ved estimation

```{r script2, code = readLines("C:/Users/AKF/Documents/Matematik-Okonomi/5. Ar/2. Semester/Master-Thesis/Scripts/Speciale.R"), include=FALSE, cache=TRUE}
```

Middelværdi-varians optimering har vist sig meget sensitiv overfor den kvantitative størrelse af parametrene som indgår i vægtelsesberegningen for den relevante portefølje, dvs. forventede afkast, varianser og kovarianser. Som også er tilfældet i denne afhandling, er disse parametre estimeret via en tidsserie af afkast, men forventningen til disse estimater skal anskues skeptisk, idet de indeholder en væsentlig mængde usikkerhed.

Simuleringsforsøg har vist at porteføljer udvalgt på baggrund af Markowitz teorien med estimerede input har værre performance og er mindre efficiente end en $\tfrac{1}{n}$ (ligevægtet) portefølje, [@Frankfurter1971]. Ligeledes viser [@Chopra1993], at det er afgørende i en porteføljeanalyse at estimere forventede afkast præcist, men forventede afkast er alt andet lige svært prædiktable, [@Merton1980]. Videnskabelige artikler har foreslået ændringer til de statistiske metoder som ligger bag estimaterne, heriblandt foreslår [@Jorion1986] at benytte en Bayes-estimator i stedet for det aritmetiske gennemsnit, se evt. også [@MacKinlay2000], [@Garlappi2007], [@Kan2007], [@Tu2011].

I det følgende, vil et illustrativt *Monte Carlo* simuleringseksempel blive foretaget, hvor der tages udgangspunkt i tre risikobærende aktiver, hvis kvartalvise afkast alle er normalfordelt med de første to momenter som set i Tabel \@ref(tab:true). Afkastene er identisk fordelte i alle kvartaler. Det årlige forventede afkast er hhv. $9\%$, $15.76\%$ og $5.12\%$. Standardafvigelsen er hhv. $20.694\%$, $25.794\%$ og $17.320\%$. Det antages, at der er ens positiv korrelation mellem hvert aktiv, på $0.5$. Derudover står investoren overfor et risikofrit aktiv med et kvartalvist afkast på $0.125\%$, og dermed et årligt risikofrit afkast på $0.5\%$. Disse er de sande parameterværdier, som givetvis er skjult information for investoren til en hvis grad. Investoren skal dermed estimere værdierne fra en tidsserie af observationer trukket fra den korrekte fordeling. Tre tidsserier af afkastsobservationer er blevet simuleret fra den relevante multivariate fordeling. Hver observation er hhv. beregnet som
\begin{align*}
r_1 &= \mu_1 + \sigma_1\nu_1\\
r_2 &= \mu_2 + \sigma_2\left(\rho_{1,2}\nu_1 + \sqrt{1-\rho_{1,2}^2}\nu_2\right)\\
r_3 &= \mu_3 + \sigma_3 \left( \rho_{1,3} \nu_1+ \frac{ \rho_{2,3}-\rho_{1,2}\rho_{1,3} }{\sqrt{1-\rho_{1,2}^2}}\nu_2+\sqrt{1-\rho_{1,3}^2 -\frac{\left(\rho_{2,3}-\rho_{1,2}\rho_{1,3}\right)^2}{1-\rho_{1,2}^2}}\nu_3\right),
\end{align*}

hvor $\mu_i$ er middelværdien, $\sigma_i$ er standardafvigelsen og $\nu_i\sim N(0,1)$ er stød til tidsserien, for $i=1,2,3$.

```{r sim-tids, echo=FALSE, fig.align='center', fig.cap='Simulerede afkast fra første simulering.', fig.width=18, fig.height=15, fig.pos='H'}
data <- c(data_1[,1], data_1[,2], data_1[,3])
data <- data.frame(sim=data, type = c(rep(1, 200), rep(2,200), rep(3,200)))
data <- data.frame(data, index = seq(1,200))

data2 <- data.frame(trueval=c(return), simval=data_1_mean, type = c(1,2,3))

ggplot(data, aes(index, sim)) + 
  geom_hline(data=data2, aes(yintercept = trueval, color = "Sand middelværdi", linetype = "Sand middelværdi")) +
  geom_hline(data=data2, aes(yintercept = simval, color = "Estimeret middelværdi", linetype = "Estimeret middelværdi")) +
  geom_line() +
  facet_wrap(~type, scales = "free_y", ncol = 1) +
  xlab(expression(italic("Indeks")))+
  ylab(expression(italic("Afkast")))+
  scale_x_continuous(expand = c(0,0))+
  scale_y_continuous(expand = c(0,0))+
  theme_bw()+
  scale_colour_brewer(palette = "Dark2") +
  scale_linetype_manual(values=c("longdash", "dotted"))+
  theme(
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size=20)
  ) +
  labs(color = "Middelværdi", linetype = "Middelværdi")
```

Hver tidsserie er baseret på $200$ observationer, svarende til en 50-årig periode med kvartalvise observationer. For hver tidsserie er de første to momenter estimeret ud fra de gængse statistiske metoder

```{r true, echo=FALSE}
data <- round(data.frame(Expect = return*100, Std = std*100, Corr = corr), digits = 3)
rownames(data) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3')


data %>% 
  knitr::kable(caption = 'Gengivelse af de sande momenter.',
               booktabs=TRUE,
               align = c('r', 'r', 'r' ,'r', 'r'),
               row.names = T,
               col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "Forventet afkast" = 1, "Volatilitet" = 1, "Korrelationer" = 3)) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer det sande: forventede afkast og volatilitet for de tre fiktive aktiver samt de sande korrelationer mellem aktiverne. Momenterne er opgjort kvartalsvist.}", threeparttable = T, escape = FALSE, general_title = "")
```

(ref:as2007) [@Asmussen2007]

```{r sim1, echo=FALSE}

data_1 <- round(data.frame(Expect = data_1_mean*100, Std = data_1_sd*100, Rele = (qnorm(0.025, lower.tail = F)*data_1_sd)/(sqrt(200)*data_1_mean), Corr = data_1_cor), digits = 3)

rownames(data_1) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3')

data_1 %>% 
  knitr::kable(caption = 'Gengivelse af første simulation af afkast.',
               booktabs=TRUE,
               align = c('r','r', 'r' ,'r', 'r'),
               row.names = T,
               col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "Forventet afkast" = 1, "Volatilitet" = 1, "Relativ fejl" = 1, "Korrelationer" = 3)) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer det estimerede: forventede afkast og volatilitet for de tre fiktive aktiver samt de estimerede korrelationer mellem aktiverne, ved brug af tidsserien fra første simulation af afkast. De relative fejl for hver simulation er ligeledes rapporteret, (ref:as2007). Momenterne er opgjort kvartalsvist.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r sim2, echo=FALSE}
data_2 <- round(data.frame(Expect = data_2_mean*100, Std = data_2_sd*100, Rele = (qnorm(0.025, lower.tail = F)*data_2_sd)/(sqrt(200)*data_2_mean), Corr = data_2_cor), digits = 3)

rownames(data_2) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3')

data_2 %>% 
  knitr::kable(caption = 'Gengivelse af anden simulation af afkast.',
               booktabs=TRUE,
               align = c('r','r', 'r' ,'r', 'r'),
               row.names = T,
               col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "Forventet afkast" = 1, "Volatilitet" = 1, "Relativ fejl" = 1, "Korrelationer" = 3)) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer det estimerede: forventede afkast og volatilitet for de tre fiktive aktiver samt de estimerede korrelationer mellem aktiverne, ved brug af tidsserien fra anden simulation af afkast. De relative fejl for hver simulation er ligeledes rapporteret, (ref:as2007). Momenterne er opgjort kvartalsvist.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r sim3, echo=FALSE}
data_3 <- round(data.frame(Expect = data_3_mean*100, Std = data_3_sd*100, Rele = (qnorm(0.025, lower.tail = F)*data_3_sd)/(sqrt(200)*data_3_mean), Corr = data_3_cor), digits = 3)

rownames(data_3) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3')

data_3 %>% 
  knitr::kable(caption = 'Gengivelse af tredje simulation af afkast.',
               booktabs=TRUE,
               align = c('r','r', 'r' ,'r', 'r'),
               row.names = T,
               col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "Forventet afkast" = 1, "Volatilitet" = 1, "Relativ fejl" = 1, "Korrelationer" = 3)) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer det estimerede: forventede afkast og volatilitet for de tre fiktive aktiver samt de estimerede korrelationer mellem aktiverne, ved brug af tidsserien fra tredje simulation af afkast. De relative fejl for hver simulation er ligeledes rapporteret, (ref:as2007). Momenterne er opgjort kvartalsvist.}", threeparttable = T, escape = FALSE, general_title = "")
```

Disse tre sæt af estimerede parametre, baseret på de tre tidsserier, er blevet udvalgt til det følgende illustrative formål. Se Tabel \@ref(tab:sim1), Tabel \@ref(tab:sim2) og Tabel \@ref(tab:sim3) for en sammenligning ift. de sande parametre. De relative fejl for hver simulering er ligedes rapporteret, [@Asmussen2007]. Disse beregnes som
$$\varepsilon_{i,j} = \frac{z_{0.975}\hat{\sigma}_{i,j}}{\sqrt{R}\hat{\mu}_{i,j}},$$

hvor $i=1,2,3$ repræsenterer aktiverne og $j=1,2,3$ repræsenterer simuleringen. $z_{0.975}$ er fraktilfunktionen fra standard normal fordelingen, for et signifikansniveau på $\alpha=0.05$. $R$ er antallet af observationer fra hver simulering, i dette forsøg er $R=200$.

Ud fra de sande parametre samt de estimerede parametre fra de tre tidsserier er global minimum varians porteføljen, tangensporteføljen, den optimale portefølje for en *CRRA* investor med risikoaversions parameter lig hhv. $1$, $5$ og $10$, samt den optimale portefølje for en *CARA* investor med risikoaversions parameter lig hhv. $1$, $5$ og $10$.

Porteføljen for *CARA*-investoren er beregnet som
$$w^*=\frac{\mu_{\text{tan}}-r_0}{(\theta W_0)\sigma_{\text{tan}}^2},$$

hvor $w^*$ er den del af formuen som investoren skal investere i tangensporteføljen. Det estimerede forventede afkast, $\mu_{\text{tan}}$, og variansen af tangensporteføljen, $\sigma_{\text{tan}}^2$, er beregnet via de estimerede momenter af hvert aktiv. Delen som skal investeres i det risikofrie aktiv, bliver beregnet residuerligt som
$$w_{r_0}^*=1-w^*.$$

*CRRA*-porteføljen er beregnet som i Sektion \@ref(crraportef). Herudover er det sande forventede afkast og den sande standardafvigelse beregnet for hver portefølje, ved brug af de sande momenter præsenteret ovenfor.

```{r sum-true, echo=FALSE}
options(knitr.kable.NA = '')
data <- round(data.frame(Min = c(port_true$gmv$weights,0,port_true$gmv$er*100, NA, port_true$gmv$sd*100, NA),
                         Tan = c(port_true$tan$weights,0,port_true$tan$er*100, NA, port_true$tan$sd*100, NA),
                         Crra_1 = c(port_true$crra_1$weights, port_true$crra_1$er*100, NA, port_true$crra_1$sd*100, NA),
                         Crra_4 = c(port_true$crra_4$weights, port_true$crra_4$er*100, NA, port_true$crra_4$sd*100, NA),
                         Crra_8 = c(port_true$crra_8$weights, port_true$crra_8$er*100, NA, port_true$crra_8$sd*100, NA),
                         cara_1 = c(port_true$cara_1$weights, port_true$cara_1$er*100, NA, port_true$cara_1$sd*100, NA),
                         cara_4 = c(port_true$cara_4$weights, port_true$cara_4$er*100, NA, port_true$cara_4$sd*100, NA),
                         cara_8 = c(port_true$cara_8$weights, port_true$cara_8$er*100, NA, port_true$cara_8$sd*100, NA)), digits = 3)

rownames(data) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3', 'Risikofri', 'Forv. Afkast', 'Estimeret afkast', 'Volatilitet', 'Estimeret volatilitet')
colnames(data) <- c(" "," ","$\\gamma=1$", "$\\gamma=4$", "$\\gamma=8$", "$\\theta=1$", "$\\theta=4$", "$\\theta=8$")

data %>% 
  knitr::kable(caption = 'Gengivelse af de beregnede porteføljer ved brug af de sande afkast.',
               booktabs=TRUE,
               align = c('r', 'r', 'r' ,'r', 'r'),
               row.names = T,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "GMV" = 1, "Tangens" = 1, "CRRA" = 3, "CARA" = 3), escape = F) %>% 
  kableExtra::row_spec(c(6, 8), italic = T) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer: vægtene for hhv. global minimum varians porteføljen, tangensporteføljen, CRRA-porteføljen og CARA-portføljen ved brug af de sande momenter. Derudover rapporterer tabellen det sande forventede afkast for hver af porteføljerne og den sande volatilitet for hver af porteføljerne. Porteføljerne er opgjort kvartalsvist, ergo de skal holdes over ét helt kvartal, for at opnå det forventede afkast. For CRRA- samt CARA-porteføljen er vægtene beregnet for en delmængde af risikoaversioner.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r sum-1, echo=FALSE}
options(knitr.kable.NA = '')
data <- round(data.frame(Min = c(port_1$gmv$weights,
                                 0,
                                 sum(port_1$gmv$weights*return)*100,
                                 port_1$gmv$er*100,
                                 sqrt(t(port_1$gmv$weights) %*% cov %*% port_1$gmv$weights)*100,
                                 port_1$gmv$sd*100),
                         Tan = c(port_1$tan$weights,
                                 0,
                                 sum(port_1$tan$weights*return)*100,
                                 port_1$tan$er*100,
                                 sqrt(t(port_1$tan$weights) %*% cov %*% port_1$tan$weights)*100,
                                 port_1$tan$sd*100),
                         Crra_1 = c(port_1$crra_1$weights,
                                 sum(port_1$crra_1$weights*c(return, rf))*100,
                                 port_1$crra_1$er*100,
                                 sqrt(t(port_1$crra_1$weights[1:3]) %*% cov %*% port_1$crra_1$weights[1:3])*100,
                                 port_1$crra_1$sd*100),
                         Crra_4 = c(port_1$crra_4$weights,
                                 sum(port_1$crra_4$weights*c(return, rf))*100,
                                 port_1$crra_4$er*100,
                                 sqrt(t(port_1$crra_4$weights[1:3]) %*% cov %*% port_1$crra_4$weights[1:3])*100,
                                 port_1$crra_4$sd*100),
                         Crra_8 = c(port_1$crra_8$weights,
                                 sum(port_1$crra_8$weights*c(return, rf))*100,
                                 port_1$crra_8$er*100,
                                 sqrt(t(port_1$crra_8$weights[1:3]) %*% cov %*% port_1$crra_8$weights[1:3])*100,
                                 port_1$crra_8$sd*100),
                         cara_1 = c(port_1$cara_1$weights,
                                 sum(port_1$cara_1$weights*c(return, rf))*100,
                                 port_1$cara_1$er*100,
                                 sqrt(t(port_1$cara_1$weights[1:3]) %*% cov %*% port_1$cara_1$weights[1:3])*100,
                                 port_1$cara_1$sd*100),
                         cara_4 = c(port_1$cara_4$weights,
                                 sum(port_1$cara_4$weights*c(return, rf))*100,
                                 port_1$cara_4$er*100,
                                 sqrt(t(port_1$cara_4$weights[1:3]) %*% cov %*% port_1$cara_4$weights[1:3])*100,
                                 port_1$cara_4$sd*100),
                         cara_8 = c(port_1$cara_8$weights,
                                 sum(port_1$cara_8$weights*c(return, rf))*100,
                                 port_1$cara_8$er*100,
                                 sqrt(t(port_1$cara_8$weights[1:3]) %*% cov %*% port_1$cara_8$weights[1:3])*100,
                                 port_1$cara_8$sd*100)), digits = 3)

rownames(data) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3', 'Risikofri', 'Forv. Afkast', 'Estimeret afkast', 'Volatilitet', 'Estimeret volatilitet')
colnames(data) <- c(" "," ","$\\gamma=1$", "$\\gamma=4$", "$\\gamma=8$", "$\\theta=1$", "$\\theta=4$", "$\\theta=8$")

data %>% 
  knitr::kable(caption = 'Gengivelse af de beregnede porteføljer ved brug af de simulerede afkast, fra første simulering.',
               booktabs=TRUE,
               align = c('r', 'r', 'r' ,'r', 'r'),
               row.names = T,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "GMV" = 1, "Tangens" = 1, "CRRA" = 3, "CARA" = 3), escape = F) %>% 
  kableExtra::row_spec(c(6, 8), italic = T) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer: vægtene for hhv. global minimum varians porteføljen, tangensporteføljen, CRRA-porteføljen og CARA-portføljen ved brug af de simulerede momenter, fra første simulering. Derudover rapporterer tabellen det sande forventede afkast for hver af porteføljerne og den sande volatilitet for hver af porteføljerne.  Samt de estimerede forventede afkast for hver af porteføljerne og den estimerede volatilitet for hver af porteføljerne. Porteføljerne er opgjort kvartalsvist, ergo de skal holdes over ét helt kvartal, for at opnå det forventede afkast. For CRRA- samt CARA-porteføljen er vægtene beregnet for en delmængde af risikoaversioner.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r sum-2, echo=FALSE}
options(knitr.kable.NA = '')
data <- round(data.frame(Min = c(port_2$gmv$weights,
                                 0,
                                 sum(port_2$gmv$weights*return)*100,
                                 port_2$gmv$er*100,
                                 sqrt(t(port_2$gmv$weights) %*% cov %*% port_2$gmv$weights)*100,
                                 port_2$gmv$sd*100),
                         Tan = c(port_2$tan$weights,
                                 0,
                                 sum(port_2$tan$weights*return)*100,
                                 port_2$tan$er*100,
                                 sqrt(t(port_2$tan$weights) %*% cov %*% port_2$tan$weights)*100,
                                 port_2$tan$sd*100),
                         Crra_1 = c(port_2$crra_1$weights,
                                 sum(port_2$crra_1$weights*c(return, rf))*100,
                                 port_2$crra_1$er*100,
                                 sqrt(t(port_2$crra_1$weights[1:3]) %*% cov %*% port_2$crra_1$weights[1:3])*100,
                                 port_2$crra_1$sd*100),
                         Crra_4 = c(port_2$crra_4$weights,
                                 sum(port_2$crra_4$weights*c(return, rf))*100,
                                 port_2$crra_4$er*100,
                                 sqrt(t(port_2$crra_4$weights[1:3]) %*% cov %*% port_2$crra_4$weights[1:3])*100,
                                 port_2$crra_4$sd*100),
                         Crra_8 = c(port_2$crra_8$weights,
                                 sum(port_2$crra_8$weights*c(return, rf))*100,
                                 port_2$crra_8$er*100,
                                 sqrt(t(port_2$crra_8$weights[1:3]) %*% cov %*% port_2$crra_8$weights[1:3])*100,
                                 port_2$crra_8$sd*100),
                         cara_1 = c(port_2$cara_1$weights,
                                 sum(port_2$cara_1$weights*c(return, rf))*100,
                                 port_2$cara_1$er*100,
                                 sqrt(t(port_2$cara_1$weights[1:3]) %*% cov %*% port_2$cara_1$weights[1:3])*100,
                                 port_2$cara_1$sd*100),
                         cara_4 = c(port_2$cara_4$weights,
                                 sum(port_2$cara_4$weights*c(return, rf))*100,
                                 port_2$cara_4$er*100,
                                 sqrt(t(port_2$cara_4$weights[1:3]) %*% cov %*% port_2$cara_4$weights[1:3])*100,
                                 port_2$cara_4$sd*100),
                         cara_8 = c(port_2$cara_8$weights,
                                 sum(port_2$cara_8$weights*c(return, rf))*100,
                                 port_2$cara_8$er*100,
                                 sqrt(t(port_2$cara_8$weights[1:3]) %*% cov %*% port_2$cara_8$weights[1:3])*100,
                                 port_2$cara_8$sd*100)), digits = 3)

rownames(data) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3', 'Risikofri', 'Forv. Afkast', 'Estimeret afkast', 'Volatilitet', 'Estimeret volatilitet')
colnames(data) <- c(" "," ","$\\gamma=1$", "$\\gamma=4$", "$\\gamma=8$", "$\\theta=1$", "$\\theta=4$", "$\\theta=8$")

data %>% 
  knitr::kable(caption = 'Gengivelse af de beregnede porteføljer ved brug af de simulerede afkast, fra anden simulering.',
               booktabs=TRUE,
               align = c('r', 'r', 'r' ,'r', 'r'),
               row.names = T,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "GMV" = 1, "Tangens" = 1, "CRRA" = 3, "CARA" = 3), escape = F) %>% 
  kableExtra::row_spec(c(6, 8), italic = T) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer: vægtene for hhv. global minimum varians porteføljen, tangensporteføljen, CRRA-porteføljen og CARA-portføljen ved brug af de simulerede momenter, fra anden simulering. Derudover rapporterer tabellen det sande forventede afkast for hver af porteføljerne og den sande volatilitet for hver af porteføljerne.  Samt de estimerede forventede afkast for hver af porteføljerne og den estimerede volatilitet for hver af porteføljerne. Porteføljerne er opgjort kvartalsvist, ergo de skal holdes over ét helt kvartal, for at opnå det forventede afkast. For CRRA- samt CARA-porteføljen er vægtene beregnet for en delmængde af risikoaversioner.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r sum-3, echo=FALSE}
options(knitr.kable.NA = '')
data <- round(data.frame(Min = c(port_3$gmv$weights,
                                 0,
                                 sum(port_3$gmv$weights*return)*100,
                                 port_3$gmv$er*100,
                                 sqrt(t(port_3$gmv$weights) %*% cov %*% port_3$gmv$weights)*100,
                                 port_3$gmv$sd*100),
                         Tan = c(port_3$tan$weights,
                                 0,
                                 sum(port_3$tan$weights*return)*100,
                                 port_3$tan$er*100,
                                 sqrt(t(port_3$tan$weights) %*% cov %*% port_3$tan$weights)*100,
                                 port_3$tan$sd*100),
                         Crra_1 = c(port_3$crra_1$weights,
                                 sum(port_3$crra_1$weights*c(return, rf))*100,
                                 port_3$crra_1$er*100,
                                 sqrt(t(port_3$crra_1$weights[1:3]) %*% cov %*% port_3$crra_1$weights[1:3])*100,
                                 port_3$crra_1$sd*100),
                         Crra_4 = c(port_3$crra_4$weights,
                                 sum(port_3$crra_4$weights*c(return, rf))*100,
                                 port_3$crra_4$er*100,
                                 sqrt(t(port_3$crra_4$weights[1:3]) %*% cov %*% port_3$crra_4$weights[1:3])*100,
                                 port_3$crra_4$sd*100),
                         Crra_8 = c(port_3$crra_8$weights,
                                 sum(port_3$crra_8$weights*c(return, rf))*100,
                                 port_3$crra_8$er*100,
                                 sqrt(t(port_3$crra_8$weights[1:3]) %*% cov %*% port_3$crra_8$weights[1:3])*100,
                                 port_3$crra_8$sd*100),
                         cara_1 = c(port_3$cara_1$weights,
                                 sum(port_3$cara_1$weights*c(return, rf))*100,
                                 port_3$cara_1$er*100,
                                 sqrt(t(port_3$cara_1$weights[1:3]) %*% cov %*% port_3$cara_1$weights[1:3])*100,
                                 port_3$cara_1$sd*100),
                         cara_4 = c(port_3$cara_4$weights,
                                 sum(port_3$cara_4$weights*c(return, rf))*100,
                                 port_3$cara_4$er*100,
                                 sqrt(t(port_3$cara_4$weights[1:3]) %*% cov %*% port_3$cara_4$weights[1:3])*100,
                                 port_3$cara_4$sd*100),
                         cara_8 = c(port_3$cara_8$weights,
                                 sum(port_3$cara_8$weights*c(return, rf))*100,
                                 port_3$cara_8$er*100,
                                 sqrt(t(port_3$cara_8$weights[1:3]) %*% cov %*% port_3$cara_8$weights[1:3])*100,
                                 port_3$cara_8$sd*100)), digits = 3)

rownames(data) <- c('Aktiv 1', 'Aktiv 2', 'Aktiv 3', 'Risikofri', 'Forv. Afkast', 'Estimeret afkast', 'Volatilitet', 'Estimeret volatilitet')
colnames(data) <- c(" "," ","$\\gamma=1$", "$\\gamma=4$", "$\\gamma=8$", "$\\theta=1$", "$\\theta=4$", "$\\theta=8$")

data %>% 
  knitr::kable(caption = 'Gengivelse af de beregnede porteføljer ved brug af de simulerede afkast, fra tredje simulering.',
               booktabs=TRUE,
               align = c('r', 'r', 'r' ,'r', 'r'),
               row.names = T,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F) %>% 
  kableExtra::add_header_above(c(" ", "GMV" = 1, "Tangens" = 1, "CRRA" = 3, "CARA" = 3), escape = F) %>% 
  kableExtra::row_spec(c(6, 8), italic = T) %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer: vægtene for hhv. global minimum varians porteføljen, tangensporteføljen, CRRA-porteføljen og CARA-portføljen ved brug af de simulerede momenter, fra tredje simulering. Derudover rapporterer tabellen det sande forventede afkast for hver af porteføljerne og den sande volatilitet for hver af porteføljerne. Samt de estimerede forventede afkast for hver af porteføljerne og den estimerede volatilitet for hver af porteføljerne. Porteføljerne er opgjort kvartalsvist, ergo de skal holdes over ét helt kvartal, for at opnå det forventede afkast. For CRRA- samt CARA-porteføljen er vægtene beregnet for en delmængde af risikoaversioner.}", threeparttable = T, escape = FALSE, general_title = "")
```

Ved brug af de sande momenter, hælder minimum varians porteføljen mod Aktiv 3, med den relative laveste varians. Se Tabel \@ref(tab:sum-true). Omtrent en tredjedel af porteføljen er eksponeret i Aktiv 1 og Aktiv 2 har den laveste vægtning givet dens høje relative varians. Tangensporteføljen består af to lange positioner i Aktiv 1 og Aktiv 2, tilsammen finansieret af en kort position i Aktiv 3, hvilket reflekterer rangeringen af aktiverne ift. deres *Sharpe Ratio*.
Fælles for alle tre simuleringer er, at de estimerede standard afvigelser og korrelationer er relativt tæt på de sande værdier. Som det til gengæld kan ses, er de forventede afkast langt sværere at estimere præcist. Hvilket er en essentiel faldgrube for middelværdi-varians porteføljeanalysen, da disse værdier er centrale for de udledte porteføljevægte.

For første simulering ses, i Tabel \@ref(tab:sum-1), at det forventede afkast på Aktiv 1 og specielt Aktiv 2 er overestimeret, mens det for Aktiv 3 er underestimeret. Dette medfører en ekstrem tangensportefølje med en overvægtet lang position i Aktiv 2, en lang position i Aktiv 1 og en kort position i det underestimerede Aktiv 3. De sande forventede afkast af tangensporteføljen og de optimale porteføljer for første simulering er signifikant lavere end det forventede afkast baseret på estimaterne. Omvendt ses at den sande volatilitet kun er en anelse højere end den estimerede volatilitet på porteføljerne. Som illustreret af den grønne linje på Figur \@ref(fig:weight-exp), er det sande bytteforhold mellem middelværdi og volatilitet på de estimerede porteføljer ikke langt fra porteføljerne baseret på de sande parametre, som illusreret af den magenta farve linje.

For anden simulering er de estimerede forventede afkast alle underestimeret relativt meget, sammenlignet med første simuelering, se Tabel \@ref(tab:sum-2). Aktiv 2 er stadig mest attraktiv, men Aktiv 3 er nu mere attraktiv end Aktiv 1 grundet den højere *Sharpe Ratio*. Både den estimerede *CRRA*-portefølje, *CARA*-portefølje og tangensportefølje har en høj positiv vægt på Aktiv 2 og meget lave positioner i Aktiv 1 og 3. Alle disse porteføljer har et langt højere sandt forventet afkast og en relativt højere sand volatilitet end de forventede afkast og volatilitet baseret på estimaterne, grundet de store estimationsfejl. Den orange farvede linje på Figur \@ref(fig:weight-exp), viser portefølje bytteforholdene baseret på anden simulering.

Tredje simulering overestimerer Aktiv 1 samt 2 og underestimerer Aktiv 3. Rangeringen ift. *Sharpe Ratio* følger den sande rangering, men eksponeringen i Aktiv 1 og 2 er forhøjet, oftest sammensat med en kort position i Aktiv 3. De sande forventede afkast på porteføljerne er generelt noget lavere end de estimerede forventede afkast. Den sande volatilitet og den estimerede volatilitet ligger tæt op af hinanden. Den fjerde og sidste linje på Figur \@ref(fig:weight-exp) viser bytteforholdet for porteføljerne baseret på tredje simulering, som tilmed er lilla.

```{r weight-exp, echo=FALSE, fig.align='center', fig.cap='Global minimum varians portføljen, tangensporteføljen samt for CRRA- og CARA-porteføljen for hhv. $\\gamma=1$, $\\gamma=4$ og $\\gamma=8$ samt $\\theta=1$, $\\theta=4$ og $\\theta=8$, beregnet ud for hhv. de sande og simulerede afkast. Bemærk at akserne er blevet $\\log_{10}$ transformeret.', fig.pos='H', fig.width=18, fig.asp=0.5, warning=FALSE}
data <- data.frame(sd=c(sd, sd_1, sd_2, sd_3), r = c(r, r_1, r_2, r_3), type = c(rep("Sande momenter", 8), rep("1. Simulering", 8), rep("2. Simulering", 8), rep("3. Simulering", 8)))

ggplot(data, aes(sd, r)) +
  geom_point(aes(color = factor(type),
                 group = factor(type),
                 shape = factor(type),
                 size = factor(type))) +
  geom_line(aes(color = factor(type),
                group = factor(type),
                linetype=factor(type))) +
  expand_limits(x = 0, y = 0) +
  xlab(expression(italic("Volatilitet"))) +
  ylab(expression(italic("Forventet afkast"))) +
  coord_cartesian(ylim = c(min(data$r)-0.0003,
                           max(data$r)+0.010),
                  xlim = c(min(data$sd)-0.001,
                           max(data$sd)+0.015)) +
  scale_x_continuous(expand = c(0,0),
                     minor_breaks = seq(0, 0.5, 0.05),
                     breaks = c(0.025, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45),
                     trans = "log10") +
  scale_y_continuous(expand = c(0,0),
                     minor_breaks = seq(0 , 0.15, 0.025),
                     breaks = c(0.01, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15),
                     trans = "log10") +
  theme_bw() +
  scale_colour_brewer(palette = "Dark2") +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "twodash")) +
  scale_shape_manual(values=c(15, 16, 17, 18)) +
  scale_size_manual(values=c(3, 3, 3, 3)) +
  theme(
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Grundlag",
       linetype = "Grundlag",
       shape = "Grundlag",
       size = "Grundlag")
```

# Allokering af aktiver
```{r script11, code = readLines("C:/Users/AKF/Documents/Matematik-Okonomi/5. Ar/2. Semester/Master-Thesis/Scripts/Script.R"), include=FALSE, cache=TRUE}
```

```{r script2, code = readLines("C:/Users/AKF/Documents/Matematik-Okonomi/5. Ar/2. Semester/Master-Thesis/Scripts/Portfolio.R"), include=FALSE, cache=TRUE}
```

```{r AL-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af allokeringer.', fig.width=18, fig.asp=0.5, fig.pos='H'}
alpha <- xts::xts(t(dynport$alphafixedT), index(NET_TB))

colnames(alpha) <- c('A', 'B', 'C', 'D')

ggplot(alpha) +
  expand_limits(x = min(index(alpha)), y = min(alpha))+
  geom_line(aes(x=index(alpha), y=A, color = 'T-Bills', linetype = "T-Bills")) +
  geom_line(aes(x=index(alpha), y=B, color = 'Aktier', linetype = "Aktier")) +
  geom_line(aes(x=index(alpha), y=C, color = 'Statsobligationer', linetype = "Statsobligationer")) +
  geom_line(aes(x=index(alpha), y=D, color = 'Virksomhedsobligationer', linetype = "Virksomhedsobligationer")) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(alpha), max(alpha))) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(alpha)), max(index(alpha))))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

```{r AL-RES-tids, echo=FALSE, fig.align='center', fig.cap='Tidsserie af allokeringer, med restringeret kortsalg.', fig.width=18, fig.asp=0.5, fig.pos='H'}
alpha_res <- xts::xts(t(dynport$res_alphafixedT), index(NET_TB))

colnames(alpha_res) <- c('A', 'B', 'C', 'D')

ggplot(alpha_res) +
  expand_limits(x = min(index(alpha_res)), y = min(alpha_res)-0.25)+
  geom_line(aes(x=index(alpha_res), y=A, color = 'T-Bills', linetype = "T-Bills")) +
  geom_line(aes(x=index(alpha_res), y=B, color = 'Aktier', linetype = "Aktier")) +
  geom_line(aes(x=index(alpha_res), y=C, color = 'Statsobligationer', linetype = "Statsobligationer")) +
  geom_line(aes(x=index(alpha_res), y=D, color = 'Virksomhedsobligationer', linetype = "Virksomhedsobligationer")) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='pink', alpha=0.2)+
  coord_cartesian(ylim = c(min(alpha_res)-0.25, max(alpha_res)+0.25)) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_x_date(expand = c(0, 0), date_labels = "%Y", date_breaks = "2 year", limits = c(min(index(alpha_res)), max(index(alpha_res))))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

```{r AL-KOMP, echo=FALSE}
options(knitr.kable.NA = '')

KOMP <- format(round(KOMP*100, digits = 3), nsmall = 3)

colnames(KOMP) <- c('Tangensporteføljen', 'GMV', 'Myopic Demand', 'IHD')

rownames(KOMP) <- c('T-Bills', 'Aktier', 'Statsobligationer', 'Virksomhedsobligationer')

KOMP %>% 
  knitr::kable(caption = 'Komposition.',
               booktabs=TRUE,
               align = c(rep('r', 4)),
               row.names = TRUE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position"),
                             full_width = F)  %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af den multiple regression ift. responsvariablen: merafkastet på aktier, $rx_{t+1}^{\\\\text{a}}$. Hver række repræsenterer et led i den mutiple regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r AL-BIG, echo=FALSE}
options(knitr.kable.NA = '')

BIG_TABLE <- data.frame(BIG_TABLE)

BIG_TABLE <- format(round(BIG_TABLE*100, digits = 3), nsmall = 3)

BIG_TABLE <- cbind(c(2, rep(NA, 3), 5, rep(NA, 3), 10, rep(NA, 3), 20, rep(NA, 3)), rep(c('T-Bills', 'Aktier', 'Statsobligationer', 'Virksomhedsobligationer'), 4), BIG_TABLE)

colnames(BIG_TABLE) <- c('$\\gamma$', 'Aktiv', '1', '4', '8', '20', '40', '60', '80', '100')

BIG_TABLE %>% 
  knitr::kable(caption = 'Komposition.',
               booktabs=TRUE,
               align = c('l', 'l', rep('r', 8)),
               row.names = FALSE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position", "scale_down"),
                             full_width = F)  %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af den multiple regression ift. responsvariablen: merafkastet på aktier, $rx_{t+1}^{\\\\text{a}}$. Hver række repræsenterer et led i den mutiple regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r AL-RES-BIG, echo=FALSE}
options(knitr.kable.NA = '')

BIG_R_TABLE <- data.frame(BIG_R_TABLE)

BIG_R_TABLE <- format(round(BIG_R_TABLE*100, digits = 3), nsmall = 3)

BIG_R_TABLE <- cbind(c(2, rep(NA, 3), 5, rep(NA, 3), 10, rep(NA, 3), 20, rep(NA, 3)), rep(c('T-Bills', 'Aktier', 'Statsobligationer', 'Virksomhedsobligationer'), 4), BIG_R_TABLE)

colnames(BIG_R_TABLE) <- c('$\\gamma$', 'Aktiv', '1', '4', '8', '20', '40', '60', '80', '100')

BIG_R_TABLE %>% 
  knitr::kable(caption = 'Komposition restringeret.',
               booktabs=TRUE,
               align = c('l', 'l', rep('r', 8)),
               row.names = FALSE,
               escape = FALSE,
               #col.names = NULL,
               linesep = "") %>% 
   kableExtra::kable_styling(bootstrap_options = "striped",
                             latex_options = c("striped", "HOLD_position", "scale_down"),
                             full_width = F)  %>% 
   kableExtra::footnote(general = "\\\\textit{Denne tabel rapporterer den beskrivende statistik af den multiple regression ift. responsvariablen: merafkastet på aktier, $rx_{t+1}^{\\\\text{a}}$. Hver række repræsenterer et led i den mutiple regression. Dette gøres ud fra $259$ kvartalvise observationer, som spænder over kvartalerne fra 2. kvartal 1954 til 4. kvartal 2018. Koefficienter markeret med \\\\textbf{fed} implicerer signifikans, for et signifikansniveau på $\\\\alpha=0.05$. Standardfejl er justeret for heteroskedasticitet og autokorrelation, (ref:nw1987). Konfidensintervallerne for koefficienterne, $t$-værdierne og $p$-værdierne er ligedes dannet på baggrund af de justerede standardfejl. $R^2$ er ligedes rapporteret, bemærk dette ikke er den justerede $R^2$.}", threeparttable = T, escape = FALSE, general_title = "")
```

```{r HOR-ana, echo=FALSE, fig.align='center', fig.cap='Horisontanalyse.', fig.width=18, fig.asp=0.5, fig.pos='H'}
HOR_ANA <- data.frame(t(HOR_ANA), index=c(1, 3:100))

colnames(HOR_ANA) <- c('A', 'B', 'C', 'D', 'index')

ggplot(HOR_ANA) +
  expand_limits(x = min(HOR_ANA$index), y = min(HOR_ANA[,1:3]))+
  geom_line(aes(x=index, y=A, color = 'T-Bills', linetype = "T-Bills")) +
  geom_line(aes(x=index, y=B, color = 'Aktier', linetype = "Aktier")) +
  geom_line(aes(x=index, y=C, color = 'Statsobligationer', linetype = "Statsobligationer")) +
  geom_line(aes(x=index, y=D, color = 'Virksomhedsobligationer', linetype = "Virksomhedsobligationer")) +
  coord_cartesian(ylim = c(min(HOR_ANA[,1:3]) - 0.05, max(HOR_ANA[,1:3]) + 0.05)) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

```{r HOR-RES-ana, echo=FALSE, fig.align='center', fig.cap='Horisontanalyse restringeret.', fig.width=18, fig.asp=0.5, fig.pos='H'}
HOR_ANA_R <- data.frame(t(HOR_ANA_R), index=c(1, 3:100))

colnames(HOR_ANA_R) <- c('A', 'B', 'C', 'D', 'index')

ggplot(HOR_ANA_R) +
  expand_limits(x = min(HOR_ANA_R$index), y = min(HOR_ANA_R[,1:3]))+
  geom_line(aes(x=index, y=A, color = 'T-Bills', linetype = "T-Bills")) +
  geom_line(aes(x=index, y=B, color = 'Aktier', linetype = "Aktier")) +
  geom_line(aes(x=index, y=C, color = 'Statsobligationer', linetype = "Statsobligationer")) +
  geom_line(aes(x=index, y=D, color = 'Virksomhedsobligationer', linetype = "Virksomhedsobligationer")) +
  coord_cartesian(ylim = c(min(HOR_ANA_R[,1:3]) - 0.05, max(HOR_ANA_R[,1:3]) + 0.05)) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

```{r GAM-ana-t, echo=FALSE, fig.align='center', fig.cap='Risikotolerance analyse, T-Bills.', fig.width=18, fig.asp=0.5, fig.pos='H'}
GAM_ANA <- data.frame(t(GAM_ANA), index=1/seq(1, 50, 0.1))

colnames(GAM_ANA) <- c('A', 'B', 'C', 'D', 'index')

ggplot(GAM_ANA) +
  geom_line(aes(x=index, y=A, color = 'T-Bills', linetype = "T-Bills")) +
  coord_cartesian(xlim = c(1, 0),
                  ylim = c(min(GAM_ANA[,1]-0.05),
                           max(GAM_ANA[,1]+0.05))) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

```{r GAM-ana-a, echo=FALSE, fig.align='center', fig.cap='Risikotolerance analyse, aktier.', fig.width=18, fig.asp=0.5, fig.pos='H'}
ggplot(GAM_ANA) +
  geom_line(aes(x=index, y=B, color = 'Aktier', linetype = "Aktier")) +
  coord_cartesian(xlim = c(1, 0),
                  ylim = c(min(GAM_ANA[,2]-0.05),
                           max(GAM_ANA[,2]+0.05))) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

```{r GAM-ana-s, echo=FALSE, fig.align='center', fig.cap='Risikotolerance analyse, statsobligationer.', fig.width=18, fig.asp=0.5, fig.pos='H'}
ggplot(GAM_ANA) +
  geom_line(aes(x=index, y=C, color = 'Statsobligationer', linetype = "Statsobligationer")) +
  coord_cartesian(xlim = c(1, 0),
                  ylim = c(min(GAM_ANA[,3]-0.05),
                           max(GAM_ANA[,3]+0.05))) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

```{r GAM-ana-v, echo=FALSE, fig.align='center', fig.cap='Risikotolerance analyse, virksomhedsobligationer.', fig.width=18, fig.asp=0.5, fig.pos='H'}
ggplot(GAM_ANA) +
  geom_line(aes(x=index, y=D, color = 'Virksomhedsobligationer', linetype = "Virksomhedsobligationer")) +
  coord_cartesian(xlim = c(1, 0),
                  ylim = c(min(GAM_ANA[,4]-0.05),
                           max(GAM_ANA[,4]+0.05))) +
  scale_linetype_manual(values=c("solid", "dashed", "dotted", "dotdash"))+
  scale_y_continuous(expand=c(0,0))+
  scale_colour_brewer(palette = "Dark2") +
  theme_bw()+
  theme(
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = "white",
                                     linetype="solid",
                                     size = 0.1,
                                     colour = "black"),
    legend.position="bottom",
    legend.key.size = unit(4, "line"),
    legend.title = element_blank(),
    legend.text=element_text(size = 20)
  ) +
  labs(color = "Aktiv",
       linetype = "Aktiv",
       shape = "Aktiv",
       size = "Aktiv")
```

# Diskussion

# Konklusion

